
* Fixture: SocialRest

| standard-test-setup     |                  |

| st-clear-events         |                  |
| set-nlw-cookie-for-user | %%username%%     |
| get                     | /nlw/events.scgi |
| code-is                 | 200              |
| body-like               | []               |

| post-json | /data/signals    | {"signal":"Hey guys"} |
| code-is   | 201              |                       |
| get       | /nlw/events.scgi |                       |
| code-is   | 200              |                       |
| body-like | Hey guys         |                       |

# Test that users don't see events from other accounts
| set              | account2         | a2%%start_time%%                     |              |
| create-account   | %%account2%%     |                                      |              |
| create-workspace | w2%%start_time%% | %%account2%%                         |              |
| set              | bob              | bob%%start_time%%@ken.socialtext.net |              |
| create-user      | %%bob%%          | password                             | %%account2%% |
| http-user-pass   | %%bob%%          | password                             |              |
| post-json        | /data/signals    | {"signal":"My name is bob"}          |              |
| code-is          | 201              |                                      |              |

# Send a signal from a different account, shouldn't show up
| http-user-pass | %%username%%     | %%password%% |
| get            | /nlw/events.scgi |              |
| code-is        | 200              |              |
| body-unlike    | My name is bob   |              |

# Move that user into our account, and it should now show up
| add-member             | %%username%%     | w2%%start_time%% |
| st-reload-event-daemon |                  |                  |
| get                    | /nlw/events.scgi |                  |
| code-is                | 200              |                  |
| body-like              | My name is bob   |                  |
