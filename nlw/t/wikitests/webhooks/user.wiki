* Fixture: WebHook

| *Comment*      | Setup  |                                      |
| set            | u1     | u1-%%start_time%%@ken.socialtext.net |
| create-user    | %%u1%% | password                             |
| set            | u2     | u2-%%start_time%%@ken.socialtext.net |
| create-user    | %%u2%% | password                             |
| set            | u3     | u3-%%start_time%%@ken.socialtext.net |
| create-user    | %%u3%% | password                             |
| set            | u4     | u4-%%start_time%%@ken.socialtext.net |
| create-user    | %%u4%% | password                             |
| set | accnt_id |

| clear-webhooks |
| clear-webhook  |

| comment       | No webhooks, deactivate user does not fire webhooks |   |
| st-clear-jobs |                                                     |   |
| st-admin      | deactivate-user --email %%u1%%                      |   |
| job-count     | WebHook                                             | 0 |

| comment               | Deactivate a user                  |               |    |
| new-webhook-testcase  |                                    |               |    |
| add-webhook           | user.deactivate                    | http://tou.ch | {} |
| st-admin              | deactivate-user --email %%u2%%     |               |    |
| job-count             | WebHook                            | 1             |    |
| st-process-jobs       |                                    |               |    |
| job-count             | WebHook                            | 0             |    |
| webhook-payload-parse |                                    |               |    |
| json-like             | [{"class":"user.deactivate"}]      |               |    |
| json-like             | [{"object":{"username":"%%u2%%"}}] |               |    |

| comment               | Reactivate a user                  |               |    |
| new-webhook-testcase  |                                    |               |    |
| add-webhook           | user.activate                      | http://tou.ch | {} |
| reactivate-user       | %%u2%%                             |               |    |
| job-count             | WebHook                            | 1             |    |
| st-process-jobs       |                                    |               |    |
| job-count             | WebHook                            | 0             |    |

| comment               | add user to account                            |                     |    |
| set                   | acct2                                          | acct2%%start_time%% |    |
| create-account        | %%acct2%%                                      |                     |    |
| set                   | acct2_id                                       | %%account_id%%      |    |
| new-webhook-testcase  |                                                |                     |    |
| add-webhook           | user.joinaccount                               | http://tou.ch       | {} |
| add-user-to-account   | %%u3%%                                         | %%acct2%%           |    |
| job-count             | WebHook                                        | 1                   |    |
| st-process-jobs       |                                                |                     |    |
| job-count             | WebHook                                        | 0                   |    |
| webhook-payload-parse |                                                |                     |    |
| json-like             | [{"class":"user.joinaccount"}]                 |                     |    |
| json-like             | [{"object":{"user":{"username":"%%u3%%"}}}]    |                     |    |
| json-like             | [{"object":{"account":{"account_id":"%%acct2_id%%"}}}] |                     |    |
