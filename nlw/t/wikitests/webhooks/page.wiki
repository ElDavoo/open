* Fixture: SocialRest

| standard-test-setup |                   |     |                |
| set-business-admin  | %%email_address%% | 1   |                |
| clear-webhooks      |                   |     |                |
| st-clear-jobs |

# Page.create hook

| PUT_json | /data/webhooks | {"class":"page.create","url":"http://example.com"} |
| code-is | 201 |
| edit-page           | %%workspace%%     | Foo | Sample Content |
| job-count     | WebHook   | 1   |                |
| clear-webhooks      |                   |     |                |

# Tag a page, verify no webhooks fired

| st-clear-jobs |               |     |                |
| PUT | /data/workspaces/%%workspace%%/pages/Foo/tags/bar | | |
| code-is | 201 |
| job-count     | WebHook   | 0   |                |

# Add a webhook, Tag a page, verify webhook fires

| st-clear-jobs |               |     |                |
| PUT_json | /data/webhooks | {"class":"page.tag","url":"http://example.com","workspace_id":"%%workspace_id%%"} |
| code-is | 201 |
| PUT | /data/workspaces/%%workspace%%/pages/Foo/tags/baz | | |
| code-is | 201 |
| job-count     | WebHook   | 1   |                |

# Delete a tag, verify webhook fires
| st-clear-jobs |               |     |                |
| DELETE | /data/workspaces/%%workspace%%/pages/Foo/tags/baz | | |
| code-is | 204 |
| job-count     | WebHook   | 1   |                |

# Tag a page in a different workspace
| set              | ws2               | ws2-%%start_time%% |
| create-workspace | %%ws2%%           |                    |
| add-member       | %%email_address%% | %%ws2%%            |
| edit-page           | %%ws2%%     | Foo2 | Sample Content |
| st-clear-jobs |               |     |                |
| PUT | /data/workspaces/%%ws2%%/pages/Foo/tags/baz | | |
| code-is | 201 |
| job-count     | WebHook   | 0   |                |

# Try adding an invalid webhook class

| PUT_json | /data/webhooks | {"class":"page.nothing","url":"http://example.com"} |
| code-is | 400 |
| body-like | not a valid webhook |
