* Fixture: SocialRest

| standard-test-setup |

| set | admin | admin%%start_time%%@q.q |
| create-user | %%admin%% | password | %%account%% |
| add-member | %%admin%% | %%workspace%% | workspace_admin |
| set | peon | peon%%start_time%%@q.q |
| create-user | %%peon%% | password | %%account%% |
| add-member | %%peon%% | %%workspace%% | member |

| http-user-pass | %%admin%% | password |
| GET | /data/workspaces/%%workspace%%/users | application/json|
| code-is | 200 |
| json-parse |
| json-array-size | 3 |
| json-like | [{"username":"%%username%%","role_name":"workspace_admin"},{"username":"%%admin%%","role_name":"workspace_admin"},{"username":"%%peon%%","role_name":"member","roles":["member"]}] |

* Add peon to some group
* Add that group to workpace A with role workspace_admin

| set | group | %%start_time%% group! |
| create-group           | %%group%% |               |                 |
| add-group-to-workspace | %%group%% | %%workspace%% | workspace_admin |
| add-user-to-group      | %%peon%%  | %%group%%       |                 |

| http-user-pass | %%admin%% | password |
| GET | /data/workspaces/%%workspace%%/users | application/json|
| code-is | 200 |
| json-parse |
| json-array-size | 3 |
| json-like | [{"username":"%%username%%","role_name":"workspace_admin"},{"username":"%%admin%%","role_name":"workspace_admin"},{"username":"%%peon%%","role_name":"workspace_admin","roles":["member","workspace_admin"]}] |

| add-member | %%peon%% | %%workspace%% | impersonator |

| http-user-pass | %%admin%% | password |
| GET | /data/workspaces/%%workspace%%/users | application/json|
| code-is | 200 |
| json-parse |
| json-array-size | 3 |
| json-like | [{"username":"%%username%%","role_name":"workspace_admin"},{"username":"%%admin%%","role_name":"workspace_admin"},{"username":"%%peon%%","role_name":"impersonator","roles":["workspace_admin","impersonator"]}] |

| remove-member | %%peon%% | %%workspace%% |

| http-user-pass | %%admin%% | password |
| GET | /data/workspaces/%%workspace%%/users | application/json|
| code-is | 200 |
| json-parse |
| json-array-size | 3 |
| json-like | [{"username":"%%username%%","role_name":"workspace_admin"},{"username":"%%admin%%","role_name":"workspace_admin"},{"username":"%%peon%%","role_name":"workspace_admin","roles":["workspace_admin"]}] |

| add-member             | %%peon%% | %%workspace%% |
| remove-user-from-group | %%peon%% | %%group%%     |

| http-user-pass | %%admin%% | password |
| GET | /data/workspaces/%%workspace%%/users | application/json|
| code-is | 200 |
| json-parse |
| json-array-size | 3 |
| json-like | [{"username":"%%username%%","role_name":"workspace_admin"},{"username":"%%admin%%","role_name":"workspace_admin"},{"username":"%%peon%%","role_name":"member","roles":["member"]}] |

| set | group2 | %%start_time%% group two! |
| create-group           | %%group2%% |               |              |
| add-group-to-workspace | %%group2%% | %%workspace%% | impersonator |
| add-user-to-group      | %%peon%%   | %%group%%     |              |
| add-user-to-group      | %%peon%%   | %%group2%%    |              |

| http-user-pass | %%admin%% | password |
| GET | /data/workspaces/%%workspace%%/users | application/json|
| code-is | 200 |
| json-parse |
| json-array-size | 3 |
| json-like | [{"username":"%%username%%","role_name":"workspace_admin"},{"username":"%%admin%%","role_name":"workspace_admin"},{"username":"%%peon%%","role_name":"impersonator","roles":["member","workspace_admin","impersonator"]}] |
