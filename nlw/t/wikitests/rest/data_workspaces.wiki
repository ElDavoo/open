Test case for `/data/workspaces`; the Workspace list

* Fixture: SocialRest

| standard-test-setup |
| set | wksp | workspace_%%start_time%% |

| *Comment* | Can't query a Workspace that doesn't exist |
| GET       | /data/workspaces/%%wksp%%                  |
| code-is   | 404                                        |

| *Comment* | Workspace name validation                               |                  |
| GET       | /data/workspaces/aa                                     | text/html        |
| code-is   | 400                                                     |                  |
| GET       | /data/workspaces/aa                                     | application/json |
| code-is   | 400                                                     |                  |
| body-like | Workspace name must be between 3 and 30 characters long |                  |

| *Comment*        | Get list of Workspaces that are visible to a User |                              |             |
| set              | peon                                              | peon_%%start_time%%@q.q      |             |
| create-user      | %%peon%%                                          | password                     | %%account%% |
| set              | ws_one                                            | peon_ws_one_%%start_time%%   |             |
| set              | ws_two                                            | peon_ws_two_%%start_time%%   |             |
| set              | ws_three                                          | peon_ws_three_%%start_time%% |             |
| create-workspace | %%ws_one%%                                        | %%account%%                  |             |
| create-workspace | %%ws_two%%                                        | %%account%%                  |             |
| create-workspace | %%ws_three%%                                      | %%account%%                  |             |
| add-member       | %%peon%%                                          | %%ws_one%%                   |             |
| add-member       | %%peon%%                                          | %%ws_two%%                   |             |
| http-user-pass   | %%peon%%                                          | password                     |             |
| GET              | /data/workspaces                                  | application/json             |             |
| code-is          | 200                                               |                              |             |
| body-like        | "name":"%%ws_one%%"                               |                              |             |
| body-like        | "name":"%%ws_two%%"                               |                              |             |
| body-like        | "id":                                             |                              |             |
| body-like        | "workspace_id":                                   |                              |             |
| body-unlike      | "name":"%%ws_three%%"                             |                              |             |

## Setup so we can test POST
| set                | non_default_acct     | non-default%%start_time%%                       |                      |
| create-account     | %%non_default_acct%% |                                                 |                      |
| set                | non_default_acct_id  | %%account_id%%                                  |                      |
| set                | bus_admin            | business-admin%%start_time%%@ken.socialtext.net |                      |
| create-user        | %%bus_admin%%        | password                                        | %%non_default_acct%% |
| set-business-admin | %%bus_admin%%        | 1                                               |                      |
| set                | bus_admin_id         | %%user_id%%                                     |                      |
| set                | auth_user            | auth-user-%%start_time%%@ken.socialtext.net     |                      |
| create-user        | %%auth_user%%        | password                                        |                      |
| set                | auth_user_id         | %%user_id%%                                     |                      |
| set                | violin               | violin-ws-%%start_time%%                        |                      |
| set                | viola                | viola-ws-%%start_time%%                         |                      |
| set                | cello                | cello-ws-%%start_time%%                         |                      |
| set                | double_bass          | double-bass-ws-%%start_time%%                   |                      |
| set                | octo_bass            | octo-bass-ws-%%start_time%%                     |                      |

## POST to a workspace, Using an account_id arg.
| *Comment*      | POST to a workspace, Using an account_id arg |                                                                              |
| http-user-pass | %%bus_admin%%                                | password                                                                     |
| POST-json      | /data/workspaces                             | {"name":"%%violin%%","title":"Violin","account_id":"%%default_account_id%%"} |
| code-is        | 201                                          |                                                                              |
| GET-json       | /data/workspaces?q=all                       |                                                                              |
| code-is        | 200                                          |                                                                              |
| body-like | qr/\{"workspace_id":"\d+","name":"%%violin%%",[^\}]+,"account_id":"%%default_account_id%%",[^\}]+,"title":"Violin","id":"\d+"\}/s |

## POST to a workspace, Using the creator's account_id
| *Comment* | POST to a workspace, Using the creator's account_id |                                      |
| POST-json | /data/workspaces                                    | {"name":"%%viola%%","title":"Viola"} |
| code-is   | 201                                                 |                                      |
| GET-json  | /data/workspaces?q=all                              |                                      |
| code-is   | 200                                                 |                                      |
| body-like | qr/\{"workspace_id":"\d+","name":"%%viola%%",[^\}]+,"account_id":"%%non_default_acct_id%%",[^\}]+,"title":"Viola","id":"\d+"\}/s |

## POST, authenticated user cannot create a workspace in an account they don't have access to
| *Comment*      | POST, authenticated user, unauthorized account |                                                                             |
| http-user-pass | %%auth_user%%                                  | password                                                                    |
| POST-json      | /data/workspaces                               | {"name":"%%cello%%","title":"Cello","account_id":"%%non_default_acct_id%%"} |
| code-is        | 401                                            |                                                                             |
| body-like      | user cannot access account                     |                                                                             |

## POST, authenticated user
| *Comment*      | POST, authenticated user |                                      |
| http-user-pass | %%auth_user%%            | password                             |
| POST-json      | /data/workspaces         | {"name":"%%cello%%","title":"Cello"} |
| code-is        | 201                      |                                      |

## POST, create multiple workspaces
| *Comment* | POST, create multiple workspaces |                                                                                                 |
| POST-json | /data/workspaces                 | [{"name":"%%double_bass%%","title":"Double Bass"},{"name":"%%octo_bass%%","title":"Octo Bass"}] |
| code-is   | 201                              |                                                                                                 |
