Tests for [Story: Groups ReST API]

* Fixture: SocialRest

| standard-test-setup |
| delete-all-groups |

# Should be no groups to start

| GET | /data/groups |
| code-is | 200 |
| header-like | Cache-Control | private |
| json-parse | |
| json-array-size | 0 |

# Create a new group, make sure it shows up

| set | group_name | group%%start_time%% |
| create-group | %%group_name%% | %%account%% | %%username%% |

## visible by Group Creator (Creator sees Groups he created or is a member of)

| GET | /data/groups |
| code-is | 200 |
| header-like | Cache-Control | private |
| json-parse | |
| json-array-size | 1 |
| Body-like | "group_id":"%%group_id%%" |
| Body-like | "name":"%%group_name%%" |
| body-like | "user_count":"1" |
| body-like | "workspace_count":"0" |

# Group Visibility Rules

## visible by Business Admin (Business Admin can see all Groups)

| set            | badmin     | badmin%%start_time%%@ken.socialtext.net |
| create-user    | %%badmin%% | password                                |
| http-user-pass | %%badmin%% | password                                |

| set-business-admin | %%badmin%%         | 1       |
| GET                | /data/groups?all=1 |         |
| code-is            | 200                |         |
| header-like        | Cache-Control      | private |
| json-parse         |                    |         |
| json-array-size    | 1                  |         |
| body-like          | "user_count":"1"   |         |

| set-business-admin | %%badmin%%         | 0       |
| GET                | /data/groups?all=1 |         |
| code-is            | 200                |         |
| header-like        | Cache-Control      | private |
| json-parse         |                    |         |
| json-array-size    | 0                  |         |

## visible by Group Members (Members see Groups they are members of)
## *not* visible by other Users (can't see Groups you have no relationship to)

| set            | jane         | jane%%start_time%%@ken.socialtext.net        |
| set            | bobemail     | bobfullname%%start_time%%@ken.socialtext.net |
| set            | bobfirst     | bobfirst%%start_time%%                       |
| set            | boblast      | boblast%%start_time%%                        |
| create-user    | %%jane%%     | password                                     |
| st-admin       | create-user --e %%bobemail%% --p password --first %%bobfirst%% --last %%boblast%%  |
| http-user-pass | %%jane%%     | password                                     |

| st-admin | 
| GET                | /data/groups  |         |
| code-is            | 200           |         |
| header-like        | Cache-Control | private |
| json-parse         |               |         |
| json-array-size    | 0             |         |

| add-user-to-group | %%jane%%                  | %%group_id%% |
| add-user-to-group | %%bobemail%%              | %%group_id%% |
| GET               | /data/groups              |              |
| code-is           | 200                       |              |
| header-like       | Cache-Control             | private      |
| json-parse        |                           |              |
| json-array-size   | 1                         |              |
| Body-like         | "group_id":"%%group_id%%" |              |
| body-like         | "user_count":"3"          |              |

| GET             | /data/groups?show_members=1                                        |         |
| code-is         | 200                                                                |         |
| header-like     | Cache-Control                                                      | private |
| json-parse      |                                                                    |         |
| json-array-size | 1                                                                  |         |
| Body-like       | "group_id":"%%group_id%%"                                          |         |
| body-like       | "best_full_name":"%%bobfirst%% %%boblast%%","user_id":             |         |
| body-like       | "best_full_name":"%%jane%%","user_id":                             |         |
| body-like       | "username":"%%jane%%"                                              |         |
| body-like       | "username":"%%bobemail%%"                                          |         |



