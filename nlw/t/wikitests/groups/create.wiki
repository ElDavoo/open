* Fixture: SocialRest

Tests to create groups via REST and CLI.

| standard-test-setup |

* Create a group using the default account & user
* Make sure that user count is 0: SystemUser shouldn't added as an admin

| set      | g1                         | g1-%%start_time%%                                              |
| st-admin | create-group --name %%g1%% | %%g1%% Group has been created (Group Id:                       |
| st-admin | list-groups                | qr/%%g1%% .\s+0 .\s+0 .\s+[\w\.]+ . [\d-]+ .\s+system-user/ |

* Can't create a group with a duplicate name

| st-admin | create-group --name %%g1%% | The %%g1%% Group has already been added to the system. |

* Create with a specific account

| set | g2 | g2-%%start_time%% |
| st-admin | create-group --name %%g2%% --account %%account%% | %%g2%% Group has been created (Group Id:                        |
| st-admin | list-groups                                      | qr/%%g2%% .\s+0 .\s+0 .\s+%%account%% . [\d-]+ .\s+system-user/ |

* Create with a specific user
# This time, the user count is 1 because %%username%% is not system created, and thus should be added as an admin to the group

| set | g3 | g3-%%start_time%% |
| st-admin | create-group --name %%g3%% --email %%username%% | %%g3%% Group has been created (Group Id:                     |
| st-admin | list-groups                                     | qr/%%g3%% .\s+0 .\s+1 .\s+[\w\.]+ . [\d-]+ .\s+user-%%start_time%%/ |


* Create a group via REST

# Should get 401 as the guest user
| http-user-pass |              |                                                 |
| set            | g4           | g4-%%start_time%%                               |
| POST_json      | /data/groups | {"account_id":"%%account_id%%","name":"%%g4%%"} |
| code-is        | 401          |                                                 |

# All other users should be able to create groups
# This time, the user count is 1 because %%username%% is not system created, and thus should be added as an admin to the group
| http-user-pass     | %%username%% | %%password%%                                                            |
| set-business-admin | %%username%% | 0                                                                       |
| POST_json          | /data/groups | {"account_id":"%%account_id%%","name":"%%g4%%"}                         |
| code-is            | 201          |                                                                         |
| st-admin           | list-groups  | qr/%%g4%% .\s+0 .\s+1 .\s+%%account%% . [\d-]+ .\s+user-%%start_time%%/ |
| POST_json          | /data/groups | {"account_id":"%%account_id%%","name":"%%g4%%"}                         |
| code-is            | 409          |                                                                         |
| POST_json          | /data/groups | {"account_id"                                                           |
| code-is            | 400          |                                                                         |

* Create a group via REST with a description

| set              | g5                                       | g5-%%start_time%%                                                           |
| POST_json        | /data/groups                             | {"account_id":"%%account_id%%","name":"%%g5%%","description":"Hello World"} |
| code-is          | 201                                      |                                                                             |
| set-from-content | group_id                                 | qr/"group_id":"(\d+)"/                                                      |
| GET-json         | /data/groups/%%group_id%%                |                                                                             |
| code-is          | 200                                      |                                                                             |
| body-like        | "description":"Hello World"              |                                                                             |

# Make sure that %%username%% was added as an admin
| GET-json  | /data/groups/%%group_id%%/users          |
| code-is   | 200                                      |
| body-like | "role":"admin","username":"%%username%%" |
