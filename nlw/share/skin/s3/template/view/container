[% USE decorate %]
[% USE JSON %]
[% WRAPPER $frame_name 
    id="dashBoard"
    head_template="element/container_head"
    css_template="element/container_css"
    title=container.title
%]
[% ids = [] %]
[% FOR g = container.gadgets; ids.push(g.instance_id); END %]
<input id="widgetList" type="hidden" value="[% ids.join(',') %]"/>
<input id="containerID" type="hidden" value="[% container.id %]"/>

<div id="controls" [% IF container.hide_controls %]class="empty"[% END %]>
    <div id="st-editing-tools-edit">
        [% IF container.hello_template %]
            [% INCLUDE $container.hello_template %]
        [% ELSE %]
            <ul></ul>
        [% END %]
    </div><!-- controlsLeft END -->
    <div id="controlsRight">
        [% IF container.links_template %]
            [% INCLUDE $container.links_template container=container %]
        [% ELSE %]
            <ul></ul>
        [% END %]
    </div><!-- controlsRight END -->
</div><!-- controls END -->

<div class="notice" [% IF container.notice %]style="display:block"[% END %]>
[% container.notice %]
[% FILTER decorate('notice') %]
[% END %]
</div>

[% FILTER decorate('container_action', container.type, container.owner.username
) %][% END %] 
[% FILTER decorate('container_action_script', container.type) %] 
[% END %] 

<div id="contentContainer" class="container [% container.type %]">
    [% IF container.header_template %]
        [% INCLUDE $container.header_template %]
    [% END %]

    <div id="contentColumns">
        [% FOR col = container.columns %]
            [% class = col.stuck ? 'stuck' : 'draggable' %]
            <ul class="widgetColumn [% class %]" id="col[% loop.index %]" style="[% col.style %]">
            [% FILTER decorate('container_column_' _ loop.index _ '_end') %]
            [% END %]
            </ul>
        [% END %]
    </div><!-- columnColumns END -->

    [% IF container.footer_template %]
        [% INCLUDE $container.footer_template %]
    [% END %]

    <div class="clear"></div><!-- clear END -->
</div><!-- contentContainer END -->

<script>
    gadgets.container.setup({
        env: [% container.env.json.replace('</script>', '</scr" + "ipt>') %],
        view: "[% container.view %]",
        template: 'widget/s3.tt2'
    });
    [% FOR gadget = container.gadgets %]
        [% SET json = gadget.json %]
        gadgets.container.renderGadget(
            [% json.replace('</script>', '</scr" + "ipt>') %]
        );
    [% END %]
</script>

[% END %]
