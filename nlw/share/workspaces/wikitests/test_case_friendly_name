
| *Comment* | Test Case: Friendly Name |  |


* Fixture: SocialWidgets

| set | fname_user | fname_user_%%start_time%%@david.socialtext.net |  |
| set_default | fname | Bob_%%start_time%% |  |
| set_default | fname_first_letter | B |  |
| set_default | fname_prefix | Bob |  |
| set_default | fname_suffix | _%%start_time%% |  |
| set | fname_checker | fname_checker_%%start_time%%@david.socialtext.net |  |
| set | fname_acct | 1_fname_account_%%start_time%% |  |
| set | fname_wiki | fname-wiki-%%start_time%% |  |
| set | fname_wiki_2 | fname-wiki-2-%%start_time%% |  |
| set | fname_group | fname_group_%%start_time%% |  |
| set | fname_group_2 | fname_group_2_%%start_time%% |  |
| set | fname_page | fname_page_%%start_time%% |  |
| set | fname_tag | fname_tag_%%start_time%% |  |
| create-account | %%fname_acct%% |  |  |
| set | fname_acct_id | %%account_id%% |  |
| st-admin | create-workspace --name %%fname_wiki%% --title %%fname_wiki%% --account %%fname_acct%% | was created |  |
| st-admin | create-user --email %%fname_user%% --password %%password%% --account %%fname_acct%% | was created |  |
| st-admin | add-workspace-admin --email %%fname_user%% --workspace %%fname_wiki%% | now has the role |  |
| st-admin | invite-user --email %%fname_checker%% --workspace %%fname_wiki%% --from %%fname_user%% | has been sent |  |
| st-admin | confirm-user --email %%fname_checker%% --password %%password%% |
| st-admin | give-accounts-admin --email %%fname_checker%% | now has accounts |  |
| create-group | %%fname_group%% | %%fname_acct%% | %%fname_user%% |
| set | fname_group_id | %%group_id%% |  |
| create-group | %%fname_group_2%% | %%fname_acct%% | %%fname_checker%% |
| set | fname_group_2_id | %%group_id%% |  |
| st-admin | add-member --email %%fname_checker%% --group %%fname_group_id%% | is now a member |  |
| st-logoutin | %%fname_user%% | %%password%% |  |

| *Comment* | Test Case: Friendly Name edit preferred name |  |
| open_ok | /st/edit_profile |  |
| wait_for_element_visible_ok | field_preferred_name | 30000 |
| type_ok | field_preferred_name | %%fname%% |
| wait_for_element_visible_ok | update_profile | 30000 |
| click_and_wait | update_profile | 30000 |
| st-name-widget | 1 | profile_widget |
| st-widget-title-like | profile_widget | Profile |
| st-select-widget-frame | profile_widget |  |
| wait_for_text_present_ok | %%fname%% | 30000 |
| select-frame | relative=parent |  |

| *Comment* | Test Case: Friendly Name send Signal |  |
| http-user-pass | %%fname_user%% | %%password%% |
| post-signal | signal text |  |
| pause | 3000 |  |
| st_process_jobs | SignalIndex |  |

| *Comment* | Test Case Friendly Name edit a page |  |
| open_ok | /%%fname_wiki%%/index.cgi?%%fname_page%% |  |
| wait_for_element_visible_ok | st-create-content-savelink | 30000 |
| click_and_wait | st-create-content-savelink |  |
| wait_for_element_visible_ok | st-mode-wikitext-button | 30000 |
| click_ok | st-mode-wikitext-button |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | page text |
| wait_for_element_visible_ok | st-save-button-link | 30000 |
| click_and_wait | st-save-button-link |  |

| *Comment* | Test Case Friendly Name comment on a page |  |
| wait_for_element_visible_ok | st-comment-button-link | 30000 |
| click_ok | st-comment-button-link |  |
| wait_for_element_visible_ok | //textarea[@name='comment'] | 30000 |
| type_ok | //textarea[@name='comment'] | comment text |
| wait_for_element_visible_ok | //a[@class='saveButton genericOrangeButton'] | 30000 |
| click_ok | //a[@class='saveButton genericOrangeButton'] |  |

| *Comment* | Test Case: Friendly Name check rich mobile interface |  |
| st-logoutin | %%fname_checker%% | %%password%% |
| open_ok | /st/m/signals |  |
| wait_for_element_visible_ok | link=%%fname%% | 30000 |
| open_ok | /m/people?letter=%%fname_first_letter%% |  |
| wait_for_element_visible_ok | link=%%fname%% | 30000 |
| open_ok | /m/page/%%fname_wiki%%/%%fname_page%% |  |
| wait_for_element_visible_ok | link=%%fname%% | 30000 |

| *Comment* | Test Case: Friendly Name Check signal |  |
| open_ok | /st/signals |  |
| wait_for_element_present_ok | link=%%fname%% | 30000 |

| *Comment* | Test Case: Friendly Name Check activities widget |  |
| open_ok | /st/dashboard |  |
| st-name-widget | 3 | activities_widget |
| st-widget-title-like | activities_widget | Activities |
| st-select-widget-frame | activities_widget |  |
| wait_for_element_present_ok | link=%%fname%% | 30000 |
| select-frame | relative=parent |  |

| *Comment* | Test Case: Friendly Name check wiki page |  |
| open_ok | /%%fname_wiki%%/index.cgi?%%fname_page%% |  |
| wait_for_text_present_ok | page text | 30000 |
| wait_for_text_present_ok | comment text | 30000 |
| wait_for_text_present_ok | contributed by %%fname%% | 30000 |
| wait_for_text_present_ok | Created by %%fname%% | 30000 |
| wait_for_text_present_ok | Updated by %%fname%% | 30000 |

| *Comment* | Test Case: Friendly Name check Hcard popup |  |
| wait_for_element_visible_ok | //span[@id='create-attribution']//a | 30000 |
| MouseOver | //span[@id='create-attribution']//a |  |
| wait_for_element_visible_ok | //div[@class='vcard'] | 30000 |
| text_like | //div[@class='vcard'] | %%fname%% |

| *Comment* | Test Case: Friendly Name check revisions list |  |
| wait_for_element_visible_ok | controls-right-revisions | 30000 |
| click_and_wait | controls-right-revisions |  |
| wait_for_element_visible_ok | link=%%fname%% | 30000 |

| *Comment* | Test Case: Friendly Name check people directory |  |
| open_ok | /?action=people |  |
| wait_for_element_visible_ok | link=%%fname%% | 30000 |

| *Comment* | Test Case: Friendly Name check group page |  |
| open_ok | /st/group/%%fname_group_id%% |  |
| st-name-widget | 1 | info_widget |
| st-widget-title-like | info_widget | Information |
| st-select-widget-frame | info_widget |  |
| wait_for_element_present_ok | link=%%fname%% | 30000 |
| select-frame | relative=parent |  |
| st-name-widget | 4 | members_widget |
| st-widget-title-like | members_widget | Membership |
| st-select-widget-frame | members_widget |  |
| wait_for_element_present_ok | link=%%fname%% | 30000 |
| select-frame | relative=parent |  |

| *Comment* | Test Case: Friendly Name check wiki members |  |
| open_ok | /%%fname_wiki%%/?action=users_listall |  |
| wait_for_text_present_ok | %%fname%% | 30000 |

| *Comment* | Test Case: Friendly Name check add user to group lookahead |  |
| open_ok | /st/edit_group/%%fname_group_2_id%% |  |
| st-name-widget | 3 | members_widget |
| st-widget-title-like | members_widget | Members |
| st-select-widget-frame | members_widget |  |
| wait_for_element_visible_ok | lookahead | 30000 |
| type_lookahead_ok | lookahead | %%fname_prefix%% |
| select-frame | relative=parent |  |
| wait_for_element_present_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%fname_suffix%%')] | 30000 |

| *Comment* | Test Case: Friendly Name check mention user in signal lookahead |  |
| open_ok | /st/signals |  |
| wait_for_element_visible_ok | //a[@title='Mention another person'] | 30000 |
| click_ok | //a[@title='Mention another person'] |  |
| wait_for_element_visible_ok | //div[@class='lookaheadDiv']/input | 30000 |
| type_lookahead_ok | //div[@class='lookaheadDiv']/input | %%fname_prefix%% |
| wait_for_element_visible_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%fname_suffix%%')] | 30000 |

| *Comment* | Test Case: Friendly Name check send private signal lookahead |  |
| open_ok | /st/signals |  |
| wait_for_element_visible_ok | //a[@title='Send a private message'] | 30000 |
| click_ok | //a[@title='Send a private message'] |  |
| wait_for_element_visible_ok | //div[@class='lookaheadDiv']/input | 30000 |
| type_lookahead_ok | //div[@class='lookaheadDiv']/input | %%fname_prefix%% |
| wait_for_element_visible_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%fname_suffix%%')] | 30000 |

| *Comment* | Test Case: Friendly Name check send page by email lookahead |  |
| open_ok | /%%fname_wiki%%/index.cgi?%%fname_page%% |  |
| wait_for_element_visible_ok | st-pagetools-email | 30000 |
| click_ok | st-pagetools-email |  |
| wait_for_element_visible_ok | email_recipient | 30000 |
| type_lookahead_ok | email_recipient | %%fname_prefix%% |
| wait_for_element_visible_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%fname_suffix%%')] | 30000 |

| *Comment* | Test Case: Friendly Name check add this tag to someone |  |
| tag_profile | %%fname_checker%% | %%fname_tag%% |
| open_ok | ?action=people;tag=%%fname_tag%% |  |
| wait_for_element_present_ok | link=Add this tag to someone | 30000 |
| click_ok | link=Add this tag to someone |  |
| wait_for_element_visible_ok | add_tag_person | 30000 |
| type_lookahead_ok | add_tag_person | %%fname_prefix%% |
| wait_for_element_visible_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%fname_suffix%%')] | 30000 |

| *Comment* | Test Case: Friendly Name check add user to group in Control Panel |  |
| open_ok | /nlw/control/group/%%fname_group_2_id%% |  |
| wait_for_element_visible_ok | addUserLookahead | 30000 |
| type_lookahead_ok | addUserLookahead | %%fname_prefix%% |
| wait_for_element_visible_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%fname_suffix%%')] | 30000 |

| *Comment* | Test Case: Friendly Name create a wiki *needs to run after checking activities widget* |  |
| open_ok | /st/dashboard |  |
| st-logoutin | %%fname_user%% | %%password%% |
| st-admin | add-account-admin --account %%fname_acct%% --e %%fname_user%% | now has the role of 'admin' |
| open_ok | /%%fname_wiki%%/?action=workspaces_create |  |
| wait_for_element_visible_ok | //input[@name='title'] | 30000 |
| type_ok | //input[@name='title'] | %%fname_wiki_2%% |
| wait_for_element_visible_ok | //input[@name='name'] | 30000 |
| type_ok | //input[@name='name'] | %%fname_wiki_2%% |
| wait_for_element_visible_ok | -savelink | 30000 |
| click_and_wait | -savelink |  |
| wait_for_text_present_ok | You have just created "%%fname_wiki_2%%" |  |
| st-admin | remove-account-admin --account %%fname_acct%% --e %%fname_user%% | no longer has the role of 'admin' |
| add-group-to-workspace | %%fname_group_id%% | %%fname_wiki_2%% |
| st-admin | add-member --email %%fname_checker%% --workspace %%fname_wiki_2%% | now has the role |
| st-logoutin | %%fname_checker%% | %%password%% |

| *Comment* | Test Case: Friendly Name check Control Panel account page |  |
| open_ok | /nlw/control/account/%%fname_acct_id%% |  |
| wait_for_text_present_ok | %%fname%% | 30000 |
| text_like | workspaces | %%fname%% |
| text_like | userTable | %%fname%% |
| text_like | groups | %%fname%% |

| *Comment* | Test Case: Friendly Name check Control Panel workspace page |  |
| open_ok | /nlw/control/account/%%fname_acct_id%% |  |
| wait_for_element_visible_ok | link=%%fname_wiki_2%% | 30000 |
| click_and_wait | link=%%fname_wiki_2%% |  |
| wait_for_text_present_ok | %%fname%% | 30000 |
| text_like | Created by: "%%fname%%" |  |
| text_like | userTable | %%fname%% |
| text_like | groupTable | %%fname%% |

| *Comment* | Test Case: Friendly Name check Control Panel workspaces list |  |
| open_ok | /nlw/control/workspace |  |
| wait_for_text_present_ok | %%fname%% | 30000 |
| text_like | workspaces | %%fname%% |

| *Comment* | Test Case: Friendly Name check Control Panel group page |  |
| open_ok | /nlw/control/group/%%fname_group_id%% |  |
| wait_for_text_present_ok | %%fname%% | 30000 |
| text_like | Created By: %%fname%% |  |
| text_like | userTable | %%fname%% |
| text_like | workspaces | %%fname%% |

| *Comment* | Test Case: Friendly Name check Control Panel user list |  |
| open_ok | /nlw/control/user |  |
| wait_for_element_visible_ok | user-sort-account | 30000 |
| click_and_wait | user-sort-account |  |
| wait_for_text_present_ok | %%fname%% | 30000 |
| *Comment* | %%fname%% needs to be checked for in two places within the same table, should occur exactly 4 times, no more or less |  |
| wait_for_element_visible_ok | //a[contains(text(),%%fname%%)][1] | 30000 |
| wait_for_element_visible_ok | //a[contains(text(),%%fname%%)][2] | 30000 |
| wait_for_element_visible_ok | //a[contains(text(),%%fname%%)][3] | 30000 |
| wait_for_element_visible_ok | //a[contains(text(),%%fname%%)][4] | 30000 |
| wait_for_element_not_present_ok | //a[contains(text(),%%fname%%)][5] | 30000 |

| *Comment* | Test Case: Friendly Name check Control Panel user page *broken* |  |
| wait_for_element_visible_ok | //a[contains(text(),'%%fname_checker%%')] | 30000 |
| click_and_wait | //a[contains(text(),'%%fname_checker%%')] |  |

 wait_for_element_visible_ok | link=%%fname%% | 30000 |
| text_like | Invited by: "%%fname%%" | |
text_like | workspaceTable | %%fname%% |









| *Comment* | Test Case: Friendly Name check people dropdown *RUN THIS LAST* |  |
| open_ok | /?action=people |  |
| wait_for_element_visible_ok | link=%%fname%% | 30000 |
| click_and_wait | link=%%fname%% |  |
| wait_for_element_visible_ok | link=Follow this person | 60000 |
| pause | 5000 | needed for IE7 |
| click_ok | link=Follow this person |  |
| wait_for_element_visible_ok | link=Stop following this person | 60000 |
| open_ok | /%%fname_wiki%%/index.cgi?%%fname_wiki%% |  |
| wait_for_element_present_ok | link=%%fname%% | 30000 |

| *Comment* | Test Case: Friendly Name teardown |  |
| st-admin | deactivate-user --email %%fname_user%% |  |
| st-admin | deactivate-user --email %%fname_checker%% |  |
| st-admin | delete-group --group %%fname_group_id%% |  |
| st-admin | delete-group --group %%fname_group_2_id%% |  |
| st-admin | delete-workspace --workspace %%fname_wiki%% |  |
| st-admin | delete-workspace --workspace %%fname_wiki_2%% |  |
