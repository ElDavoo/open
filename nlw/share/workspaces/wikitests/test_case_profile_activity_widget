| *Comment* | Test Case: Profile Activity Widget |  |

* Fixture: SocialWidgets

| set | luser | `paw-%%start_time%%@ken.socialtext.net` |
| set | short_luser | `paw %%start_time%%` |
| set | temail | %%email%% |
| set | tuser | %%short_username%% |
| set | shared_group | PAW Group %%start_time%% |
| set | shared_acct | PAW Account %%start_time%% |

| *Comment* | Test Case: Profile Activity Widget. create an account shared by %%luser%% and %%tuser%% |  |
| st-admin | create-account --name "%%shared_acct%%" | created |
| st-admin | create-user --e %%luser%% --p %%password%% --account "%%shared_acct%%" | created |
| st-admin | enable-plugin --account "%%shared_acct%%" --p signals |  |
| st-admin | enable-plugin --account "%%shared_acct%%" --p groups |  |
| st-admin | add-member --account "%%shared_acct%%" --e %%temail%% | member |

| *Comment* | Test Case: Profile Activity Widget. create a group shared by %%luser%% and %%tuser%% |  |  |
| create-group | %%shared_group%% | %%shared_acct%% | %%luser%% |
| st-admin | add-member --group %%group_id%% --e %%temail%% | member |  |

| *Comment* | Test Case: Profile Activity Widget. login in as a fellow user %%luser%% |  |
| st-logoutin | %%luser%% | %%password%% |

| *Comment* | Test Case: Profile Activity Widget. navigate to the %%tuser%% Profile page |  |
| st_process_jobs |  |  |
| st_find_user | %%tuser%% |  |

| *Comment* | Test Case: Profile Activity Widget. the basic activities widget exists on the %%tuser%% Profile page |  |
| text_like | Profile |  |
| text_like | Tags |  |
| text_like | Activities |  |
| st-name-widget | 3 | activitieswidget |
| st-widget-title-like | activitieswidget | Activities |

| *Comment* | Test Case: Profile Activity Widget. Send and check signals |  |
| st_send_signal_via_activities_widget | activitieswidget | Public signal to %%tuser%% at %%start_time%% WHOOPEE |

| st_send_signal_via_activities_widget | activitieswidget | Private signal to %%tuser%% at %%start_time%% HURRAY | private |

| st-verify-text-in-activities-widget | activitieswidget | qr/%%tuser%%.+Public signal to %%tuser%% at %%start_time%% WHOOPEE/ism |
| st-verify-text-in-activities-widget | activitieswidget | qr/You.+private to.+%%tuser%%/ism |
| st-verify-text-in-activities-widget | activitieswidget | Private signal to %%tuser%% at %%start_time%% HURRAY |

| *Comment* | Test Case: Profile Activity Widget. Clean start: navigate to the %%tuser%% Profile page |  |
| st_process_jobs |  |  |
| st_find_user | %%tuser%% |  |

| *Comment* | Test Case: Profile Activity Widget. Probe the activities widget on the %%tuser%% Profile page |  |
| text_like | Profile |  |
| text_like | Tags |  |
| text_like | Activities |  |
| st-name-widget | 3 | activitieswidget |
| st-widget-title-like | activitieswidget | Activities |
| st-select-widget-frame | activitieswidget |  |
| wait_for_text_present_ok | Showing | 10000 |
| text_like | qr/Showing all events.*from.+%%tuser%%.*within/ism |  |

| *Comment* | Test Case: Profile Activity Widget. The widget defaults to mentioning the viewed user when clicked |  |
| wait_for_element_present_ok | mainWikiwyg | 10000 |
| text_like | qr/What are you working on/ism |  |
| click_ok | mainWikiwyg |  |
| wait_for_element_visible_ok | //div[@class='message mention'] | 10000 |
| wait_for_element_visible_ok | link=%%tuser%% | 10000 |

| *Comment* | Test Case: Profile Activity Widget. message "You are composing a message to username {{[x]}}" |  |
| text_like | //div[@class='message mention'] | qr/You are composing a message to.+%%tuser%%/ism |

| *Comment* | Test Case: Profile Activity Widget. ... with a checkbox that reads: (make this signal private: {{[]}}) |  |
| text_like | qr/Make this signal private/ism |  |

| *Comment* | Test Case: Profile Activity Widget. selecting the checkbox changes the message to "... composing a private message ..." |  |
| wait_for_element_visible_ok | //input[@class='toggle-private'] | 5000 |
| click_ok | //input[@class='toggle-private'] | use click because js does not see check_ok |
| is_checked_ok | //input[@class='toggle-private'] |  |
| wait_for_text_present_ok | private | 5000 |
| text_like | //div[@class='message mention'] | qr/You are composing a private message to.+%%tuser%%/ism |

| *Comment* | Test Case: Profile Activity Widget. unselecting the checkbox changes the message back to "... composing a message ..." |  |
| click_ok | //input[@class='toggle-private'] |  |
| pause | 5000 | I Hate Pause |
| text_unlike | //div[@class='message mention'] | You are composing a private message |
| text_like | //div[@class='message mention'] | You are composing a message |

| *Comment* | Test Case: Profile Activity Widget. clicking the {{[x]}} causes the message to not mention the target user |  |
| wait_for_element_visible_ok | link=x |  |
| click_ok | link=x |  |
| wait_for_element_not_present_ok | //div[@class='message mention'] | 5000 |

| *Comment* | Test Case: Profile Activity Widget. "Post to" |  |
| text_like | qr/Post to/ism |  |

| *Comment* | Test Case: Profile Activity Widget. select list values for "from <feed-type>" filter is only the user's name |  |
| text_like | qr/Showing all events.*from.+%%tuser%%.*within/ism |  |

| *Comment* | Test Case: Profile Activity Widget. ... and cannot be changed |  |
| wait_for_element_not_present_ok | //span[@id='feed']/a | 5000 |
| wait_for_element_not_present_ok | //ul[@id='st-dropdown-1-list'] | 5000 |

| *Comment* | Test Case: Profile Activity Widget. Pulldown menus |  |
| select_frame | relative=parent |  |

| *Comment* | Test Case: Profile Activity Widget. select list values for ".. within <group>" filter shows all shared groups |  |
| wait_for_element_present_ok | //ul[@id='st-dropdown-2-list']/li[1]/a[text()='All shared groups'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-2-list']/li[2]/a[contains(text(),'%%shared_acct%%')] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-2-list']/li[3]/a[contains(text(),'%%shared_group%%')] | 5000 |

| *Comment* | Test Case: Profile Activity Widget. "Post to" select list shows all shared groups between viewer and viewee |  |
| wait_for_element_present_ok | //ul[@id='st-dropdown-3-list']/li[1]/a[text()='All shared groups'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-3-list']/li[2]/a[contains(text(),'%%shared_acct%%')] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-3-list']/li[3]/a[contains(text(),'%%shared_group%%')] | 5000 |

| *Comment* | Test Case: Profile Activity Widget. select list values for "Showing <event-type>" filter are all the standard choices |  |
| wait_for_element_present_ok | //ul[@id='st-dropdown-0-list']/li[1]/a[text()='all events'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-0-list']/li[2]/a[text()='signals'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-0-list']/li[3]/a[text()='contributions'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-0-list']/li[4]/a[text()='edits'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-0-list']/li[5]/a[text()='comments'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-0-list']/li[6]/a[text()='page tags'] | 5000 |
| wait_for_element_present_ok | //ul[@id='st-dropdown-0-list']/li[7]/a[text()='people events'] | 5000 |

| *Comment* | Test Case: Profile Activity Widget. You go to your own profile page |  |
| open_ok | /st/profile |  |
| text_like | Profile |  |
| text_like | Tags |  |
| text_like | Activities |  |
| st-name-widget | 3 | activitieswidget |
| st-widget-title-like | activitieswidget | Activities |
| st-select-widget-frame | activitieswidget |  |
| wait_for_text_present_ok | Showing | 10000 |
| text_like | qr/Showing all events.*from %%short_luser%%.*within/ism |  |

| *Comment* | Test Case: Profile Activity Widget. ... no "you are composing a message to ..." message appears |  |
| *Comment* | Test Case: Profile Activity Widget. ... you don't mention yourself |  |
| wait_for_element_not_present_ok | //div[@class='message mention'] | 5000 |

| *Comment* | Test Case: Profile Activity Widget TEARDOWN |  |
| st-admin | remove-member --group %%group_id%% --e %%temail%% | no longer a member |
| st-admin | remove-member --account "%%shared_acct%%" --e %%temail%% | no longer has the role of |

| *Comment* | Test Case: Profile Activity Widget COMPLETED |  |
