| *Comment* | Test case: Business Control Panel |  |
| *Comment* | Test case: Business Control Panel passes in a dev env and a clean appliance VE |  |
| *Comment* | If there are too many users or workspaces to fit on a single display page, it will fail |  |

| st-admin | remove-accounts-admin --email %%email%% | %%username%% no longer has accounts admin access |
| st-admin | give-accounts-admin --email %%email%% | %%username%% now has accounts admin access |

| set | new_acct | acct %%start_time%% |
| set | new_workspace | wksp-%%start_time%% |
| set | cli_user | cli_%%start_time%%@ken.socialtext.net |

| *Comment* | Test case: Business Control Panel Socialtext Account exists |  |
| open_ok | /nlw/control/account |  |
| wait_for_element_visible_ok | st-search-by-name | 30000 |
| text_like | Accounts |  |
| clickAndWait | link=Socialtext |  |
| text_like | Socialtext account |  |

| *Comment* | Test case: Business Control Panel Create and verify new account |  |
| clickAndWait | link=Accounts |  |
| wait_for_element_visible_ok | st-new-account-name | 30000 |
| type_ok | st-new-account-name | %%new_acct%% |
| click_and_wait | st-submit-new-account-name |  |
| text_like | The %%new_acct%% account has been created. |  |

| *Comment* | Test case: Business Control Panel Create a new workspace in the new account |  |
| st-admin | create-workspace --name %%new_workspace%% --title %%new_workspace%% --account "%%new_acct%%" |  |
| clickAndWait | link=%%new_acct%% |  |
| clickAndWait | link=%%new_workspace%% |  |
| text_like | %%new_workspace%% workspace |  |

| *Comment* | Test case: Business Control Panel Socialtext Search Accounts |  |
| open_ok | /nlw/control/account |  |
| wait_for_element_visible_ok | st-search-by-name | 30000 |
| type_ok | st-search-by-name | Socialtext |
| clickAndWait | st-submit-search-by-name |  |
| text_like | link=Socialtext | Socialtext |
| type_ok | st-search-by-name | %%new_acct%% |
| clickAndWait | st-submit-search-by-name |  |
| text_like | link=%%new_acct%% | %%new_acct%% |

| *Comment* | Test case: Business Control Panel Change new workspace account to Socialtext |  |
| open_ok | /nlw/control/workspace |  |
| wait_for_element_visible_ok | name | 30000 |
| type_ok | name | %%new_workspace%% |
| st-submit |  |  |
| clickAndWait | link=%%new_workspace%% |  |
| text_like | %%new_workspace%% |  |
| select_ok | account_id | label=Socialtext |
| st-submit |  |  |
| text_like | The %%new_workspace%% workspace is now part of the Socialtext account. |  |
| text_like | URI: |  |

| *Comment* | Test case: Business Control Panel Search for a non-existant workspace |  |
| clickAndWait | link=Workspaces |  |
| wait_for_element_visible_ok | name | 30000 |
| type_ok | name | zildjian |
| st-submit |  |  |
| text_like | Showing 0 - 0 of 0 total. |  |

| *Comment* | Test case: Business Control Panel search for an existing workspace |  |
| type_ok | name | %%new_workspace%% |
| st-submit |  |  |
| text_like | Showing 1 - 1 of 1 total. |  |

| *Comment* | Test case: Business Control Panel create a user, add as admin, verify admin |  |
| open_ok | /nlw/control/user |  |
| st-admin | create-user --email %%cli_user%% --password wikicli --first-name Wiki --last-name CLI | A new user with the username "%%cli_user%%" was created |
| st-admin | add-workspace-admin --email %%cli_user%% --workspace %%new_workspace%% |  |
| clickAndWait | link=Workspaces |  |
| wait_for_element_visible_ok | name | 30000 |
| type_ok | name | %%new_workspace%% |
| st-submit |  |  |
| clickAndWait | link=%%new_workspace%% |  |
| text_like | workspace admin |  |

| *Comment* | Test case: Business Control Panel give and remove account and console permissions |  |
| st-admin | give-system-admin --email %%email%% | now has system admin access |
| clickAndWait | link=Wiki CLI <%%cli_user%%> |  |
| clickAndWait | //input[@value='Give Access to Socialtext Accounts'] |  |
| text_like | Gave Socialtext Accounts access to %%cli_user%% |  |
| clickAndWait | //input[@value='Remove Access to Socialtext Accounts'] |  |
| text_like | Removed Socialtext Accounts access from %%cli_user%% |  |
| clickAndWait | //input[@value='Give Access to Socialtext System Management'] |  |
| text_like | Gave Socialtext System Management access to %%cli_user%% |  |
| clickAndWait | //input[@value='Remove Access to Socialtext System Management'] |  |
| text_like | Removed Socialtext System Management access from %%cli_user%% |  |

| *Comment* | Test case: Business Control Panel search for new user |  |
| clickAndWait | link=Users |  |
| wait_for_element_visible_ok | username | 30000 |
| type_ok | username | %%cli_user%% |
| st-submit |  |  |
| text_like | Showing 1 - 1 of 1 total. |  |

| *Comment* | Test case: Business Control Panel Set up data for sorting |  |

| st-admin | create-account --name "0 sort 1 account %%start_time%%" |  |
| st-admin | create-account --name "0 sort 2 account %%start_time%%" |  |
| st-admin | create-account --name "0 sort 3 account %%start_time%%" |  |

| st-admin | create-workspace --name 0-sort-1-workspace1-%%start_time%% --title "0 sort 1 workspace1 %%start_time%%" --account "0 sort 1 account %%start_time%%" |  |
| st-admin | create-workspace --name 0-sort-2-workspace1-%%start_time%% --title "0 sort 2 workspace1 %%start_time%%" --account "0 sort 2 account %%start_time%%" |  |
| st-admin | create-workspace --name 0-sort-3-workspace1-%%start_time%% --title "0 sort 3 workspace1 %%start_time%%" --account "0 sort 3 account %%start_time%%" |  |
| st-admin | create-workspace --name 0-sort-2-workspace2-%%start_time%% --title "0 sort 2 workspace2 %%start_time%%" --account "0 sort 2 account %%start_time%%" |  |
| st-admin | create-workspace --name 0-sort-3-workspace2-%%start_time%% --title "0 sort 3 workspace2 %%start_time%%" --account "0 sort 3 account %%start_time%%" |  |
| st-admin | create-workspace --name 0-sort-3-workspace3-%%start_time%% --title "0 sort 3 workspace3 %%start_time%%" --account "0 sort 3 account %%start_time%%" |  |

| *Comment* | Test case: Business Control Panel: TODO: change the first-name and last-name parameters to include spaces |  |

| st-admin | create-user --email 0_sort_1_user1@%%start_time%%.com --password sort1user1 --first-name "0 sort 11" --last-name "0 user 11" |
| st-admin | create-user --email 0_sort_2_user1@%%start_time%%.com --password sort2user1 --first-name "0 sort 21" --last-name "0 user 21" |
| st-admin | create-user --email 0_sort_3_user1@%%start_time%%.com --password sort3user1 --first-name "0 sort 31" --last-name "0 user 31" |
| st-admin | create-user --email 0_sort_2_user2@%%start_time%%.com --password 0sort2user2 --first-name "0 sort 22" --last-name "0 user 22" |
| st-admin | create-user --email 0_sort_3_user2@%%start_time%%.com --password 0sort3user2 --first-name "0 sort 22" --last-name "0 user 32" |
| st-admin | create-user --email 0_sort_3_user3@%%start_time%%.com --password 0sort3user3 --first-name "0 sort 33" --last-name "0 user 33" |

| st-admin | add-member --email 0_sort_1_user1@%%start_time%%.com --workspace 0-sort-1-workspace1-%%start_time%% |
| st-admin | add-member --email 0_sort_2_user2@%%start_time%%.com --workspace 0-sort-1-workspace1-%%start_time%% |
| st-admin | add-member --email 0_sort_3_user3@%%start_time%%.com --workspace 0-sort-1-workspace1-%%start_time%% |
| st-admin | add-member --email 0_sort_2_user2@%%start_time%%.com --workspace 0-sort-2-workspace2-%%start_time%% |
| st-admin | add-member --email 0_sort_3_user3@%%start_time%%.com --workspace 0-sort-2-workspace2-%%start_time%% |
| st-admin | add-member --email 0_sort_3_user3@%%start_time%%.com --workspace 0-sort-3-workspace3-%%start_time%% |

| *Comment* | Test case: Business Control Panel sorting Accounts display |  |
| open_ok | /nlw/control/account |  |

| clickAndWait | link=Name |  |
| text_like | qr/0 sort 3 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 1 account %%start_time%%/ |  |
| clickAndWait | link=Name |  |
| text_like | qr/0 sort 1 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 3 account %%start_time%%/ |  |

| clickAndWait | link=Number of Workspaces |  |
| text_like | qr/0 sort 1 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 3 account %%start_time%%/ |  |
| clickAndWait | link=Number of Workspaces |  |
| text_like | qr/0 sort 3 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 1 account %%start_time%%/ |  |

| clickAndWait | link=Number of Users |  |
| text_like | qr/0 sort 3 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 1 account %%start_time%%/ |  |
| clickAndWait | link=Number of Users |  |
| text_like | qr/0 sort 1 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 3 account %%start_time%%/ |  |

| *Comment* | Test case: Business Control Panel sorting Workspaces display |  |
| clickAndWait | link=Workspaces |  |
| clickAndWait | link=Name |  |
| text_like | qr/0-sort-3-workspace3-%%start_time%%.+0-sort-2-workspace2-%%start_time%%.+0-sort-1-workspace1-%%start_time%%/ |  |
| clickAndWait | link=Name |  |
| text_like | qr/0-sort-1-workspace1-%%start_time%%.+0-sort-2-workspace2-%%start_time%%.+0-sort-3-workspace3-%%start_time%%/ |  |

TODO: RESTORE THE FOLLOWING TWO TESTS AFTER {bz: 472} IS FIXED

| *Comment* | RESTORE THE FOLLOWING TWO TESTS AFTER {bz: 472} IS FIXED |  |
| clickAndWait | link=Number of Users |  |

 text_like | qr/0-sort-2-workspace1-%%start_time%%.+0-sort-3-workspace1-%%start_time%%.+0-sort-3-workspace2-%%start_time%%/ | |

| clickAndWait | link=Number of Users |  |

 text_like | qr/0-sort-2-workspace1-%%start_time%%.+0-sort-3-workspace1-%%start_time%%.+0-sort-3-workspace2-%%start_time%%/ | |

| clickAndWait | link=Account |  |
| text_like | qr/0 sort 1 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 3 account %%start_time%%/ |  |
| clickAndWait | link=Account |  |
| text_like | qr/0 sort 3 account %%start_time%%.+0 sort 2 account %%start_time%%.+0 sort 1 account %%start_time%%/ |

| clickAndWait | link=Created |  |
| text_like | qr/0-sort-3-workspace3-%%start_time%%.+0-sort-2-workspace2-%%start_time%%.+0-sort-1-workspace1-%%start_time%%/ |  |
| clickAndWait | link=Created |  |
| text_like | qr/0-sort-1-workspace1-%%start_time%%.+0-sort-2-workspace1-%%start_time%%.+0-sort-3-workspace1-%%start_time%%/ |  |

| clickAndWait | link=Created By |  |
| text_like | qr/devnull1.+system-user/ |  |
| clickAndWait | link=Created By |  |
| text_like | qr/system-user.+devnull1/ |  |

| *Comment* | Test case: Business Control Panel sorting Users display |  |
| clickAndWait | link=Users |  |

| clickAndWait | link=Name |  |
| text_like | qr/two.+one/ |  |
| clickAndWait | link=Name |  |
| text_like | qr/0_sort_1_user1\@%%start_time%%\.com.+0_sort_2_user2\@%%start_time%%\.com.+0_sort_3_user3\@%%start_time%%\.com/ |  |

| clickAndWait | link=Number of Workspaces |  |
| text_like | qr/0_sort_2_user1\@%%start_time%%\.com.+0_sort_3_user1\@%%start_time%%\.com.+0_sort_3_user2\@%%start_time%%\.com/ |  |
| clickAndWait | link=Number of Workspaces |  |
| text_like | qr/0_sort_3_user3\@%%start_time%%\.com.+0_sort_2_user2\@%%start_time%%\.com.+0_sort_1_user1\@%%start_time%%\.com/ |  |

| clickAndWait | link=Invited |  |
| text_like | qr/one.+two/ |  |
| clickAndWait | link=Invited |  |
| text_like | qr/0_sort_3_user3\@%%start_time%%\.com.+0_sort_2_user2\@%%start_time%%\.com.+0_sort_1_user1\@%%start_time%%\.com/ |  |

| clickAndWait | link=Invited By |  |
| text_like | qr/devnull1.+system/ |  |

| *Comment* | Test case: Business Control Panel teardown. Let %%username%% keep accounts admin privileges. |  |
| st-admin | remove-system-admin --email %%email%% | no longer has system admin access |
| st-admin | delete-workspace --workspace 0-sort-1-workspace1-%%start_time%% --no-export |  |
| st-admin | delete-workspace --workspace 0-sort-2-workspace1-%%start_time%% --no-export |  |
| st-admin | delete-workspace --workspace 0-sort-3-workspace1-%%start_time%% --no-export |  |
| st-admin | delete-workspace --workspace 0-sort-2-workspace2-%%start_time%% --no-export |  |
| st-admin | delete-workspace --workspace 0-sort-3-workspace2-%%start_time%% --no-export |  |
| st-admin | delete-workspace --workspace 0-sort-3-workspace3-%%start_time%% --no-export |  |
| st-admin | delete-workspace --workspace %%new_workspace%% --no-export |  |

| *Comment* | Test case: Business Control Panel COMPLETED |  |
