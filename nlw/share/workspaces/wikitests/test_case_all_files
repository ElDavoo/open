* HighPermissions

| *Comment* | Test Case: All Files |  |
| *Comment* | wikitest files should be in %%wikitest_files%% on the browser server |  |
| *Comment* | *This test only works if selenium_browser has higher powers, i.e. *chrome for firefox* |  |

| setSpeed | 100 |  |
| set | all_files_user_1 | `all_files_%%start_time%%_1@ken.socialtext.net` |
| set | user_1_regex | `all_files_%%start_time%%_1\@ken\.socialtext\.net` |
| set | all_files_user_2 | `all_files_%%start_time%%_2@ken.socialtext.net` |
| set | user_2_regex | `all_files_%%start_time%%_2\@ken\.socialtext\.net` |

| *Comment* | Test Case: All Files setup user_1 and user_2 |  |
| click_and_wait | link=Settings |  |
| click_and_wait | link=Time |  |
| check_ok | timezone__time_display_seconds |  |
| click_and_wait | Button |  |
| st-admin | create-user --email %%all_files_user_1%% --password 123456 |  |
| st-admin | add-member --email %%all_files_user_1%% --workspace %%workspace%% |  |
| st-admin | create-user --email %%all_files_user_2%% --password 123456 |  |
| st-admin | add-member --email %%all_files_user_2%% --workspace %%workspace%% |  |

| *Comment* | Test Case: All Files set permissions to member-only |  |
| st-admin | set-permissions --workspace %%workspace%% --permission member-only |  |

| *Comment* | Test Case: All Files user_1 uploads wikitest.doc and wikitest.jpg |  |
| st-logout |  |  |
| st-login | %%all_files_user_1%% | 123456 |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | link=Advanced | 10000 |
| click_ok | link=Advanced |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | st-newpage-pagename-edit | All Files %%start_time%% 1 |
| click_and_wait | st-save-button-link |  |
| click_ok | st-attachments-uploadbutton |  |
| wait_for_element_visible_ok | st-attachments-attach-filename | 30000 |
| type_ok | st-attachments-attach-filename | %%wikitest_files%%wikitest.jpg |
| wait_for_text_present_ok | Uploaded files: | 10000 |

| *Comment* | Test Case: All Files wikitest.jpg upload waits for the Done button |  |
| wait_for_element_visible_ok | st-attachments-attach-closebutton | 120000 |
| pause | 5000 |  |
| wait_for_element_visible_ok | st-attachments-attach-filename | 30000 |
| type_ok | st-attachments-attach-filename | %%wikitest_files%%wikitest.doc |
| wait_for_text_present_ok | Uploaded files: | 10000 |

| *Comment* | Test Case: All Files wikitest.doc upload waits for the Done button |  |
| wait_for_element_visible_ok | st-attachments-attach-closebutton | 120000 |
| pause | 5000 | i hate pause |
| click_ok | st-attachments-attach-closebutton |  |

| *Comment* | Test Case: All Files delete the links from the page |  |
| wait_for_element_visible_ok | st-edit-button-link | 30000 |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | link=Advanced | 30000 |
| click_ok | link=Advanced |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | DELETE THE CONTENT OF All Files %%start_time%% |
| click_and_wait | st-save-button-link |  |

| *Comment* | Test Case: All Files verify jpg and doc uploads |  |
| wait_for_element_visible_ok | st-attachments-title | 30000 |
| wait_for_element_visible_ok | st-attachments-listing | 10000 |
| text_like | //a[contains(@href,'original/wikitest.jpg')] | wikitest.jpg |
| text_like | //a[contains(@href,'original/wikitest.doc')] | wikitest.doc |

| *Comment* | Test Case: All Files user_2 uploads wikitestzip.zip |  |
| st-logout |  |  |
| st-login | %%all_files_user_2%% | 123456 |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | link=Advanced | 30000 |
| click_ok | link=Advanced |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 30000 |
| type_ok | st-newpage-pagename-edit | All Files %%start_time%% 2 |
| click_and_wait | st-save-button-link |  |
| click_ok | st-attachments-uploadbutton |  |
| wait_for_element_visible_ok | st-attachments-attach-filename | 30000 |
| type_ok | st-attachments-attach-filename | %%wikitest_files%%wikitestzip.zip |
| wait_for_text_present_ok | Uploaded files: | 10000 |

| *Comment* | Test Case: All Files wikitestzip.zip upload waits for the Done button |  |
| wait_for_element_visible_ok | st-attachments-attach-closebutton | 120000 |
| pause | 5000 | i hate pause |
| click_ok | st-attachments-attach-closebutton |  |

| *Comment* | Test Case: All Files delete the links from the page AGAIN |  |
| wait_for_element_visible_ok | st-edit-button-link | 30000 |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | link=Advanced | 30000 |
| click_ok | link=Advanced |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | DELETE THE CONTENT OF All Files %%start_time%% AGAIN |
| click_and_wait | st-save-button-link |  |

| *Comment* | Test Case: All Files verify zip upload |  |
| wait_for_element_visible_ok | st-attachments-title | 30000 |
| wait_for_element_visible_ok | st-attachments-listing | 10000 |
| text_like | //a[contains(@href,'original/wikitestzip.zip')] | wikitestzip.zip |

| *Comment* | Test Case: All Files list view |  |
| st-logoutin |  |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| text_like | Changes in Last |  |
| clickAndWait | link=All Files |  |
| text_like | All Files |  |

| *Comment* | Test Case: All Files Sorting tests |  |

| *Comment* | Test Case: All Files default sorted Filename asc |  |
| text_like | st-allfiles | qr/wikitest\.jpg.+wikitestzip/ |

| *Comment* | label=File name (↓ ) |  |

| *Comment* | Test Case: All Files sorted Filename desc |  |
| select_ok | sort-picker | index=1 |
| pause | 10000 |  |
| text_like | st-allfiles | qr/wikitestzip.+wikitest\.jpg/ |

| *Comment* | label=Size (↓ ) |  |

| *Comment* | Test Case: All Files sort File size desc |  |
| select_ok | sort-picker | label=Size |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 1.+All Files %%start_time%% 2/ |

| *Comment* | label=Size |  |

| *Comment* | Test Case: All Files sort File size asc |  |
| select_ok | sort-picker | index=5 |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 2.+All Files %%start_time%% 1/ |

| *Comment* | label=Title |  |

| *Comment* | Test Case: All Files sort Title asc |  |
| select_ok | sort-picker | label=Page Title |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 1.+All Files %%start_time%% 2/ |

| *Comment* | label=Title (↓ ) |  |

| *Comment* | Test Case: All Files sort Title desc |  |
| select_ok | sort-picker | index=2 |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 2.+All Files %%start_time%% 1/ |

| *Comment* | Test Case: All Files sort Uploaded by asc |  |
| select_ok | sort-picker | label=Uploaded By |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 1.+All Files %%start_time%% 2/ |

| *Comment* | label=Uploaded By (↓ ) |  |

| *Comment* | Test Case: All Files sort Uploaded by desc |  |
| select_ok | sort-picker | index=3 |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 2.+All Files %%start_time%% 1/ |

| *Comment* | label=Date (↓) |  |

| *Comment* | Test Case: All Files sort Date desc |  |
| select_ok | sort-picker | label=Date Uploaded |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 2.+All Files %%start_time%% 1/ |

| *Comment* | label=Date |  |

| *Comment* | Test Case: All Files sort Date asc |  |
| select_ok | sort-picker | index=4 |
| pause | 10000 |  |
| text_like | st-allfiles | qr/All Files %%start_time%% 1.+All Files %%start_time%% 2/ |

| *Comment* | Test Case: All Files Teardown |  |
| st-admin | purge-page --workspace %%workspace%% --page all_files_%%start_time%%_1 | page was purged |
| st-admin | purge-page --workspace %%workspace%% --page all_files_%%start_time%%_2 | page was purged |
| click_and_wait | link=Settings |  |
| click_and_wait | link=Time |  |
| uncheck_ok | timezone__time_display_seconds |  |
| click_and_wait | Button |  |
| st-admin | remove-member --email %%all_files_user_1%% --workspace %%workspace%% |  |
| st-admin | remove-member --email %%all_files_user_2%% --workspace %%workspace%% |  |

| *Comment* | Test Case: All Files COMPLETED |
