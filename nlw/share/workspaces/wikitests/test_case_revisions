from Recent Changes list view page: click a revisions link for a page with at least 5 revisions | correct All Revisions page appears

| *Comment* | START Test Case: Revisions |  |

*Comment* This test incorporates three manual test cases for Revisions

| *Comment* | Test Case: Revisions: Setting up test data |  |

| setSpeed | 100 |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| clickAndWait | st-newpage-link |  |
| wait_for_element_visible_ok | link=Advanced | 30000 |
| click_ok | link=Advanced |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| click_ok | st-newpage-pagename-edit |  |
| type_ok | st-newpage-pagename-edit | test case revisions %%start_time%% |
| type_ok | wikiwyg_wikitext_textarea | original revision number one %%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | revision number two %%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | revision number three %%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | revision number four %%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | revision number five %%start_time%% |
| clickAndWait | st-save-button-link |  |

| clickAndWait | st-page-stats-revisions |  |

| *Comment* | Test Case: Revisions: Check for sorting and the "Compare Revisions" button |  |
| text_like | qr/revision 5.+revision 4.+revision 3.+revision 2.+revision 1/ |  |
| verifyValue | Button | Compare Revisions |
| verifyValue | document.revisions.Button[1] | Compare Revisions |

 text_like | Button | Compare Revisions
 text_like | Compare Revisions

| *Comment* | Test Case: Revisions: Check the correct radio buttons are set |  |
| verifyValue | new_revision_id | on |
| verifyValue | document.revisions.old_revision_id[1] | on |

 click BackTo Current Revision | page appears
 from same page: click Revisions link at bottom of page | correct All Revisions page appears
 All Revisions page | check page for correctness | top 2 revisions are selected

| clickAndWait | st-back-to-current-revision-link |  |
| text_like | revision number five |  |

| clickAndWait | st-page-stats-revisions |  |

| *Comment* | Test Case: Revisions: Check again for sorting and the "Compare Revisions" button |  |
| text_like | qr/revision 5.+revision 4.+revision 3.+revision 2.+revision 1/ |  |
| *Comment* | Test Case: Revisions: Check again the correct radio buttons are set |  |
| verifyValue | new_revision_id | on |
| verifyValue | document.revisions.old_revision_id[1] | on |

 Compare top 2 revisions | compare page appears & correct | test both "Compare Revisions" buttons

| *Comment* | Test Case: Revisions: Comparing revisions |  |
| clickAndWait | Button |  |
| text_like | qr/Revision 4.+Revision 5.+four.+five/ |  |
| clickAndWait | st-all-revisions-link |  |
| clickAndWait | document.revisions.Button[1] |  |
| text_like | qr/Revision 4.+Revision 5.+four.+five/ |  |

 Compare two other revisions | compare page appears & correct

| clickAndWait | st-all-revisions-link |  |
| click_ok | document.revisions.old_revision_id[4] |  |
| click_ok | document.revisions.new_revision_id[1] |  |
| clickAndWait | document.revisions.Button[1] |  |
| text_like | qr/Revision 1.+Revision 4.+one.+four/ |  |

 edit a page and Save | creates a new revision | revisions count should increment
 click Revisions at top of sidebar | new entry in All Revisions | verify correctness of new entry

NOTE: validated when creating data for this test

 select the same revision in both columns, click Compare Revisions | Popup: you cannot compare a revision to itself

| clickAndWait | st-all-revisions-link |  |
| click_ok | document.revisions.old_revision_id[2] |  |
| click_ok | document.revisions.new_revision_id[2] |  |
| click_ok | Button |  |
| verifyAlert | You cannot compare a revision to itself. |  |

 Back to Current Revision | current page appears

 Click Revisions link at the top of the sidebar for a page with at least five revisions | All Revisions page appears with correct number of revisions
 Compare Revisions: older vs. younger | page appears with correct revisions. Diffs are reasonable and correct. | older on left, younger on right
 Compare Revisions: younger vs. older | page appears with correct revisions. Diffs are reasonable and correct. | younger on left, older on right

| clickAndWait | st-back-to-current-revision-link |  |
| clickAndWait | st-page-stats-revisions |  |
| clickAndWait | document.revisions.Button[1] |  |
| text_like | qr/Revision 4.+Revision 5.+four.+five/ |  |
| clickAndWait | st-all-revisions-link |  |
| click_ok | old_revision_id |  |
| click_ok | document.revisions.new_revision_id[1] |  |
| clickAndWait | Button |  |
| text_like | qr/Revision 5.+Revision 4.+five.+four/ |  |

 Back To Current Revision | current revision appears
 Click Revisions link again | All Revisions page appears with top two items selected
 click Compare Revisions | revision compare page appears
 toggle "View Formatted" | Formatted/unformatted views appear correctly.
 link at top of older revision | older revision page appears and correct.
 link at top of newer revision | newer revision page appears and correct.

| *Comment* | Test Case: Revisions: Checking revision formatting views |  |
| clickAndWait | st-back-to-current-revision-link |  |
| clickAndWait | st-page-stats-revisions |  |
| clickAndWait | Button |  |
| text_like | //td[1]/span | four |
| text_like | //td[2]/span | five |
| clickAndWait | st-view-formatted-link |  |

*Comment* TODO: validate spans are missing when we have verify_element_not_present_ok

| clickAndWait | st-view-unformatted-link |  |
| text_like | //td[1]/span | four |
| text_like | //td[2]/span | five |

| clickAndWait | //strong |  |
| text_like | qr/Revision 4.+four/ |  |

| clickAndWait | st-all-revisions-link |  |
| clickAndWait | Button |  |
| clickAndWait | //td[2]/h3/a/strong |  |
| text_like | qr/Revision 5.+five/ |  |

 Click All Revisions | all revisions page appears with correct content
 Back To Current Revision | Current revision appears
 Click "N revisions" at bottom of page | All Revisions page appears with N revisions | Note 1. 
 Select the same revision in both columns | selection successful
 click Compare Revisions | popup: You cannot compare a revision to itself
 click OK | popup dismissed

NOTE: these steps already tested above.

 Find the same page using search, What's New list, and Revisions link. Observe revision count. | Count should be correct and identical in all three results

| *Comment* | Test Case: Revisions: Checking revisions are correct when arriving at page from different paths |  |
| *Comment* | This Test Case always fails on teststaging right here when run in OSR Testcases but succeeds stand alone which suggests a ceqlotron related issue so we are going to hit it with a big hammer and see if forcing indexing makes a difference. |  |
| st-admin | index-workspace --w %%workspace%% --sync |  |
| type_ok | st-search-term | revision |

| clickAndWait | st-search-submit |  |
| wait_for_element_visible_ok | link=test case revisions %%start_time%% | 15000 |
| clickAndWait | link=test case revisions %%start_time%% |  |
| text_like | st-page-stats-revisions | 5 revisions |

| clickAndWait | st-wiki-subnav-link-whats-new |  |
| wait_for_element_visible_ok | link=test case revisions %%start_time%% | 15000 |
| clickAndWait | link=test case revisions %%start_time%% |  |
| text_like | st-page-stats-revisions | 5 revisions |

| clickAndWait | st-wiki-subnav-link-whats-new |  |
| wait_for_element_visible_ok | link=5 | 15000 |
| clickAndWait | link=5 |  |
| clickAndWait | st-back-to-current-revision-link |  |
| text_like | st-page-stats-revisions | 5 revisions |

 *user action* | *correct response* | *comment*
 from All Revisions, click an older version | older version appears
 from Compare Revisions, click the link above the older version | older version appears
 All Revisions | All Revisions page appears

| clickAndWait | st-page-stats-revisions |  |
| wait_for_element_visible_ok | link=revision 2 | 15000 |
| clickAndWait | link=revision 2 |  |
| text_like | revision number two %%start_time%% |  |
| clickAndWait | st-all-revisions-link |  |
| click | document.revisions.old_revision_id[3] |  |
| clickAndWait | Button |  |
| clickAndWait | //strong |  |
| text_like | revision number two %%start_time%% |  |
| clickAndWait | st-all-revisions-link |  |

 click the older version again
 toggle "Source View" link | Formatted/unformatted views appear correctly.
 Restore revision X | Revision X appears in view mode as current revision
 Revisions at top of sidebar | All Revisions page appears
 All Revisions | restored revision is latest revision at top of revisions list
 Check revision number | revision number is the same as the revision number from which it was restored | revision numbers are not
monotonically increasing
 Back to Current Revision | restored revision appears

| *Comment* | Test Case: Revisions: Restoring revision |  |
| wait_for_element_visible_ok | link=revision 2 | 15000 |
| clickAndWait | link=revision 2 |  |
| text_like | page-control-revision-view-source-link | Source View |
| clickAndWait | page-control-revision-view-source-link |  |
| text_like | page-control-revision-view-normal-link | Normal View |
| clickAndWait | document.forms[1].elements['Restore Revision'] |  |
| text_like | revision number two |  |
| wait_for_element_visible_ok | link=6 | 15000 |
| clickAndWait | link=6 |  |
| text_like | qr/revision 2.+revision 5.+revision 4.+revision 3.+revision 2.+revision 1/ |  |
| clickAndWait | st-back-to-current-revision-link |  |
| text_like | revision number two |  |

| *Comment* | Test Case: Revisions: Removing test page |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| clickAndWait | link=test case revisions %%start_time%% |  |
| clickAndWait | link=Delete Page |  |
| confirmation_like | Are you sure you want to delete this page? |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |

| *Comment* | Test Case: Revisions COMPLETED |  |
