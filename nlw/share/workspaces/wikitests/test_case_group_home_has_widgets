| *Comment* | Test Case: Group Home Has Widgets |

* Fixture: SocialWidgets

| *Comment* | Test Case: Group Home Has Widgets Setup |  |  |
| st-setup-a-group | 1 | 1 | 1 |
| set | just_a_member | justgroupmbr%%start_time%%@matt.socialtext.net |  |
| st-admin | create-user --e %%just_a_member%% --p %%password%% --account %%group_acct%% | was created |  |
| st-admin | add-member --e %%just_a_member%% --g %%group_id%% | is now a member of |  |

| *Comment* | Test Case: Self Join Has Widgets Console ('system') Admin has edit group and edit layout buttons |  |
| set | group_biz_admin | group_biz%%start_time%%@matt.socialtext.net |  |
| st-admin | create-user --e %%group_biz_admin%% --p %%password%% --account %%group_acct%% | was created |
| st-admin | give-system-admin --e %%group_biz_admin%% | now has system admin access |
| st-admin | add-member --e %%group_biz_admin%% --g %%group_id%% | is now a member of |  |
| st-logoutin | %%group_biz_admin%% | %%password%% |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |

| *Comment* | Test Case: Self Join Has Widgets- Control Panel ('accounts') Admin has edit group and edit layout buttons |  |
| set | group_cp_admin | group_cp_admin%%start_time%%@matt.socialtext.net |  |
| st-admin | create-user --e %%group_cp_admin%% --p %%password%% --account %%group_acct%% | was created |
| st-admin | give-accounts-admin --e %%group_cp_admin%% | now has accounts admin access |
| st-admin | add-member --e %%group_cp_admin%% --g %%group_id%% | is now a member of |  |
| st-logoutin | %%group_cp_admin%% | %%password%% |  |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |


| *Comment* | Test Case: Self Join Has Widgets Login as %%group_user%%, do not see edit group or edit layout buttons |  |
| st-logoutin | %%group_user%% | %%password%% |  |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_element_not_present_ok | st-edit-group | 30000 |
| wait_for_element_not_present_ok | st-edit-layout | 30000 |

| *Comment* | Test Case: Self Join Has Widgets Promote to admin, *do* see edit group or edit layout buttons |  |
| st-admin | add-group-admin --g %%group_id%% --e %%group_user%% | is now a admin of the |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |

| *Comment* | Test Case: Self Join Has Widgets Click Edit Layout Add widget, revert to default widget is gone |  |
| setSpeed | 1000 | Lots of click_oks, not click_and_waits here. Slowing down ... |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |
| wait_for_element_visible_ok | st-cancel-layout | 30000 |
| wait_for_element_visible_ok | st-save-layout | 30000 |
| wait_for_element_visible_ok | st-add-widget | 30000 |
| click_ok | st-cancel-layout | 30000 |
| wait_for_text_not_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |

| *Comment* | Test Case: Self Join Has Widgets Click Edit Layout Add widget, click cancel widget is gone |  |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-add-widget | 30000 |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | ///a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | st-widget-opensocial-gallery-cancel |  |
| wait_for_element_not_present_ok | ///a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | ///a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | //a[@id='gallery-widget-SlideShare Feeds'] |  |
| wait_for_text_present_ok | Wiki Search (English) | 30000 |
| click_ok | st-cancel-layout |  |
| wait_for_text_not_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_text_not_present_ok | Wiki Search (English) | 30000 |

| *Comment* | Test Case: Self Join Has Widgets Click Edit Layout Add widget, see widget, save widget is present |  |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | ///a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | ///a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | //a[@id='gallery-widget-SlideShare Feeds'] |  |
| wait_for_text_present_ok | Wiki Search (English) | 30000 |
| click_ok | st-save-layout |  |
| wait_for_text_present_ok | Wiki Search (English) | 30000 |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| wait_for_text_not_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |

| *Comment* | Test Case: Self Join Has Widgets Login as non-member, see widget |  |
| st-logoutin | %%just_a_member%% | %%password%% |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_text_present_ok | Wiki Search (English) | 30000 |

| *Comment* | Test Case: Self Join Has Widgets Edit Layout, revert, click "no, I'm not sure", wikipedia widget is still present |  |
| st-logoutin | %%group_user%% | %%password%% |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_text_present_ok | Wiki Search (English) | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |
| click_ok | st-revert-layout |  |
| wait_for_element_visible_ok | dashboard-revert-yes | 30000 |
| wait_for_element_visible_ok | dashboard-revert-no | 30000 |
| click_ok | dashboard-revert-no |  |
| wait_for_element_not_visible_ok | dashboard-revert-yes | 30000 |
| wait_for_element_not_visible_ok | dashboard-revert-no | 30000 |
| wait_for_text_present_ok | Wiki Search (English) | 30000 |

 | *Comment* | Test Case: Self Join Has Widgets Edit Layout, click "yes I am sure", widget is gone but we are still on the edit layout page | |
| click_ok | st-revert-layout | |
| wait_for_element_visible_ok | dashboard-revert-yes | 30000 |
| wait_for_element_visible_ok | dashboard-revert-no | 30000 |
| click_ok | dashboard-revert-yes | |
| wait_for_text_not_present_ok | Wiki Search (English) | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |
| wait_for_element_visible_ok | st-cancel-layout | 30000 |
| wait_for_element_visible_ok | st-save-layout | 30000 |
| wait_for_element_visible_ok | st-add-widget | 30000 |



| *Comment* | Test Case: Group Home Has Widgets TEARDOWN |  |
| setSpeed | 0 |  |
| st-admin | delete-workspace --no-export --w %%group_acct%%_central | was deleted |
| delete-group | %%group_id%% |  |

| *Comment* | Test Case: Group Home Has Widgets COMPLETED |  |
