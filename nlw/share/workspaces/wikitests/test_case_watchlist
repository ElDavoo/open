Automation for [Test: Watchlist]

user adds page to watchlist using Watchlist icon at top of sidebar icon turns color to indicate membership in watchlist

| *Comment* | STARTING Test case: Watchlist |

| setSpeed | 500 |  |
| *Comment* | Test case: Watchlist watch |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | link=Advanced | 10000 |
| click_ok | link=Advanced |  |
| type_ok | st-newpage-pagename-edit | Watchlist_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | Watchlist_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

user removes page from watchlist by clicking the star on the page icon reverses colors to indicate no longer in watchlist

| *Comment* | Test case: Watchlist unwatch |  |
| st-watch-page | 0 |  |
| st-is-watched | 0 |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

Visit some individual pages in the workspace; add them to the watchlist. View watchlist; pages appear in watchlist

| *Comment* | Test case: Watchlist check watchlist |  |
| click_and_wait | st-home-link |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 10000 |
| type_ok | st-newpage-pagename-edit | aaa_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | aaa_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |
| click_and_wait | st-home-link |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 10000 |
| type_ok | st-newpage-pagename-edit | bbb_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | bbb_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |
| click_and_wait | st-home-link |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 10000 |
| type_ok | st-newpage-pagename-edit | ccc_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | ccc_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |
| st-page-title | Pages You're Watching |  |
| text_like | st-watchlist-content | aaa_%%start_time%% |
| text_like | st-watchlist-content | bbb_%%start_time%% |
| text_like | st-watchlist-content | ccc_%%start_time%% |
| st-is-watched | 1 | aaa_%%start_time%% |
| st-is-watched | 1 | bbb_%%start_time%% |
| st-is-watched | 1 | ccc_%%start_time%% |

User removes page from watchlist through the watchlist UI.
Watchlist icon reverses color to indicate no longer a member of watchlist. 
Entry does not disappear.
User adds removed page from watchlist through the watchlist UI.
Watchlist icon reverses color to indicate a member of watchlist.

| *Comment* | Test case: Watchlist UI |  |
| st-watch-page | 0 | aaa_%%start_time%% |
| st-watch-page | 0 | bbb_%%start_time%% |
| st-watch-page | 0 | ccc_%%start_time%% |
| text_like | st-watchlist-content | aaa_%%start_time%% |
| text_like | st-watchlist-content | bbb_%%start_time%% |
| text_like | st-watchlist-content | ccc_%%start_time%% |
| st-watch-page | 1 | aaa_%%start_time%% |
| st-is-watched | 1 | aaa_%%start_time%% |
| st-watch-page | 1 | bbb_%%start_time%% |
| st-is-watched | 1 | bbb_%%start_time%% |
| st-watch-page | 1 | ccc_%%start_time%% |
| st-is-watched | 1 | ccc_%%start_time%% |

When a page that is on the watchlist is deleted, it is removed from the watchlist.
Remove all pages from watchlist; watchlist displays "No watchlist for USER ID in <workspace>"

| *Comment* | Test case: Watchlist delete page |  |
| text_like | st-watchlist-content | Watchlist_%%start_time%% |
| st-is-watched | 1 | Watchlist_%%start_time%% |
| click_and_wait | link=Watchlist_%%start_time%% |  |
| click_and_wait | link=Delete Page |  |
| confirmation_like | Are you sure you want to delete this page? |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |
| text_unlike | st-watchlist-content | Watchlist_%%start_time%% |
| *COMMENT* | verifyTextPresent No watchlist for | can't do this until we find a way to clear the watchlist
otherwise this test is not rerunnable when it fails
and the watchlist is not empty |

| *Comment* | Test case: Watchlist ADDING AND DELETING IS FINISHED |

Set up to check sorting.

| click_and_wait | st-home-link |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |

| *Comment* | Test case: Watchlist CHECKING SORTING VIEWS |

check for title sorting

| *Comment* | Test case: Watchlist title sort |  |
| click_and_wait | link=Title |  |
| text_like | qr/aaa.+bbb/ |  |
| text_like | qr/bbb.+ccc/ |  |

add a new page for date and revision sorting

| *Comment* | Test case: Watchlist date and rev sort |  |
| click_and_wait | st-home-link |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | link=Advanced | 10000 |
| click_ok | link=Advanced |  |
| type_ok | st-newpage-pagename-edit | newpage_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | newpage_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |
| click_ok | st-edit-button-link |  |
| wait_for_text_present_ok | Editing: | 30000 |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | revision_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |
| click_and_wait | link=Date |  |

check for date sorting

| *Comment* | Test case: Watchlist sort by date |  |
| text_like | qr/aaa.+bbb.+ccc.+newpage/ |  |

 *Here is a case that violates the coding standard that fixed strings should never be used*
*This test will succeed when it should fail when the watchlist is not empty*

title sort

| *Comment* | Test case: Watchlist sort by title |  |
| click_and_wait | link=Title |  |
| text_like | qr/aaa.+bbb.+ccc.+newpage/ |  |

Revisions sort

| *Comment* | Test case: Watchlist sort by revision |  |
| click_and_wait | link=Revisions |  |
| text_like | qr/newpage.+aaa/ |  |

Last Edited By sort

| *Comment* | Test case: Watchlist sort by Last Edited By |  |
| click_and_wait | link=Last Edited By |  |
| text_like | qr/aaa.+bbb.+ccc.+newpage/ |  |

cleanup so that Watchlist does not fill up

| open_ok | /%%workspace%%/index.cgi?aaa_%%start_time%% |  |
| click_and_wait | link=Delete Page |  |
| confirmation_like | Are you sure you want to delete this page? |  |

| open_ok | /%%workspace%%/index.cgi?bbb_%%start_time%% |  |
| click_and_wait | link=Delete Page |  |
| confirmation_like | Are you sure you want to delete this page? |  |

| open_ok | /%%workspace%%/index.cgi?ccc_%%start_time%% |  |
| click_and_wait | link=Delete Page |  |
| confirmation_like | Are you sure you want to delete this page? |  |

| open_ok | /%%workspace%%/index.cgi?newpage_%%start_time%% |  |
| click_and_wait | link=Delete Page |  |
| confirmation_like | Are you sure you want to delete this page? |  |

| *Comment* | Test case: Watchlist COMPLETED |

^ Remaining todo:

| Figure out a way to check which element of a dropdown menu is currently selected, text_like does not do this | Check dropdown menu functionality in Settings->Watchlist |  |
| Change notification to every minute, then edit a page in the watchlist | notification is saved as Every Minute |  |
| Wait a few minutes, then read email | watchlist notification message received |  |
| In the email, click through to change the preference for notification frequency | arrive at correct UI page |  |
| if preference in watchlist email is set to display name, links, edited by and edited date, the email is displayed correctly according to the preference | verify correct email content |  |
| if preference in watchlist email is set to display page title and link only, the email is displayed correctly | change preference, edit a watched page, receive email, verify correct email content |  |
| clicking on a page link in the watchlist email takes you to the correct page |  |  |
| when a page is removed from the watchlist, it is removed from email | remove a page from the watchlist, edit a watched page, receive email, verify that removed page is not present |  |
| when a page is removed from watch list, it is removed from rss | click RSS icon for watchlist; examine RSS content |  |
