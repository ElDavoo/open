user adds page to watchlist using Watchlist icon at top of sidebar icon turns color to indicate membership in watchlist

| *Comment* | STARTING Test case: Watchlist |

| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | link=Advanced | 30000 |
| click_ok | link=Advanced |  |
| type_ok | st-newpage-pagename-edit | Watchlist_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | Watchlist_%%start_time%% |

| *Comment* | Test case: Watchlist watch |  |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

user removes page from watchlist by clicking the star on the page icon reverses colors to indicate no longer in watchlist

| *Comment* | Test case: Watchlist unwatch and rewatch |  |
| st-watch-page | 0 |  |
| st-is-watched | 0 |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

Visit some individual pages in the workspace; add them to the watchlist. View watchlist; pages appear in watchlist

| *Comment* | Test case: Watchlist create and watch aaa |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 30000 |
| type_ok | st-newpage-pagename-edit | aaa_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | aaa_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

| *Comment* | Test case: Watchlist create and watch bbb |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 30000 |
| type_ok | st-newpage-pagename-edit | bbb_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | bbb_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

| *Comment* | Test case: Watchlist create and watch ccc |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 30000 |
| type_ok | st-newpage-pagename-edit | ccc_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | ccc_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

| *Comment* | Test case: Watchlist has three pages |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |
| st-page-title | Pages You're Watching |  |
| text_like | st-watchlist-content | aaa_%%start_time%% |
| text_like | st-watchlist-content | bbb_%%start_time%% |
| text_like | st-watchlist-content | ccc_%%start_time%% |
| st-is-watched | 1 | aaa_%%start_time%% |
| st-is-watched | 1 | bbb_%%start_time%% |
| st-is-watched | 1 | ccc_%%start_time%% |

User removes page from watchlist through the watchlist UI.
Watchlist icon reverses color to indicate no longer a member of watchlist. 
Entry does not disappear.
User adds removed page from watchlist through the watchlist UI.
Watchlist icon reverses color to indicate a member of watchlist.

| *Comment* | Test case: Watchlist UI |  |
| st-watch-page | 0 | aaa_%%start_time%% |
| st-watch-page | 0 | bbb_%%start_time%% |
| st-watch-page | 0 | ccc_%%start_time%% |
| text_like | st-watchlist-content | aaa_%%start_time%% |
| text_like | st-watchlist-content | bbb_%%start_time%% |
| text_like | st-watchlist-content | ccc_%%start_time%% |
| st-watch-page | 1 | aaa_%%start_time%% |
| st-is-watched | 1 | aaa_%%start_time%% |
| st-watch-page | 1 | bbb_%%start_time%% |
| st-is-watched | 1 | bbb_%%start_time%% |
| st-watch-page | 1 | ccc_%%start_time%% |
| st-is-watched | 1 | ccc_%%start_time%% |

When a page that is on the watchlist is deleted, it is removed from the watchlist.
Remove all pages from watchlist; watchlist displays "No watchlist for USER ID in "

| *Comment* | Test case: Watchlist delete page |  |
| text_like | st-watchlist-content | Watchlist_%%start_time%% |
| st-is-watched | 1 | Watchlist_%%start_time%% |

| st-admin | purge-page --w %%workspace%% --page watchlist_%%start_time%% | purged |

| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |
| text_unlike | st-watchlist-content | Watchlist_%%start_time%% |

| *COMMENT* | verifyTextPresent No watchlist for | can't do this until we find a way to clear the watchlist
otherwise this test is not rerunnable when it fails
and the watchlist is not empty |

| *Comment* | Test case: Watchlist ADDING AND DELETING IS FINISHED |

Set up to check sorting.

| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |

| *Comment* | Test case: Watchlist CHECKING SORTING VIEWS |

check for title sorting

| *Comment* | Test case: Watchlist unfortunately have to use pause because all pages data and elements are always the same |  |

| *Comment* | Test case: Watchlist title sort |  |
| select_and_wait | sort-picker | label=Title |
| text_like | st-listview | qr/aaa_%%start_time%%.+bbb_%%start_time%%.+ccc_%%start_time%%/ |

| *Comment* | label=Title (desc) |  |
| select_and_wait | sort-picker | index=1 |
| text_like | st-listview | qr/ccc_%%start_time%%.+bbb_%%start_time%%.+aaa_%%start_time%%/ |

| *Comment* | label=Title (asc) |  |
| select_and_wait | sort-picker | index=1 |
| text_like | st-listview | qr/aaa_%%start_time%%.+bbb_%%start_time%%.+ccc_%%start_time%%/ |

add a new page for date and revision sorting

| *Comment* | Test case: Watchlist date and rev sort |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| click_and_wait | st-newpage-link |  |
| wait_for_element_visible_ok | link=Advanced | 30000 |
| click_ok | link=Advanced |  |
| type_ok | st-newpage-pagename-edit | newpage_%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | newpage_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| st-watch-page | 1 |  |
| st-is-watched | 1 |  |

| *Comment* | Test case: Watchlist create an additional rev |  |
| click_ok | st-edit-button-link |  |
| wait_for_text_present_ok | Editing: | 30000 |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | revision_%%start_time%% |
| click_and_wait | st-save-button-link |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |

title sort

| *Comment* | Test case: Watchlist sort by title |  |
| select_and_wait | sort-picker | label=Title |
| text_like | st-listview | qr/aaa_%%start_time%%.+bbb_%%start_time%%.+ccc_%%start_time%%.+newpage_%%start_time%%/ |

| *Comment* | label=Title (desc) |  |
| select_and_wait | sort-picker | index=1 |
| text_like | st-listview | qr/newpage_%%start_time%%.+ccc_%%start_time%%.+bbb_%%start_time%%.+aaa_%%start_time%%/ |

| *Comment* | label=Title (asc) |  |
| select_and_wait | sort-picker | index=1 |
| text_like | st-listview | qr/aaa_%%start_time%%.+bbb_%%start_time%%.+ccc_%%start_time%%.+newpage_%%start_time%%/ |

check for date sorting

| *Comment* | Test case: Watchlist sort by Date |  |
| select_and_wait | sort-picker | label=Date |
| pause | 10000 | No, really, this one is needed |
| text_like | st-listview | qr/newpage_%%start_time%%.+ccc_%%start_time%%.+bbb_%%start_time%%.+aaa_%%start_time%%/ |

| *Comment* | label=Date (asc) |  |
| select_and_wait | sort-picker | index=3 |
| text_like | st-listview | qr/aaa_%%start_time%%.+bbb_%%start_time%%.+ccc_%%start_time%%.+newpage_%%start_time%%/ |

| *Comment* | label=Date (desc) |  |
| select_and_wait | sort-picker | index=3 |
| text_like | st-listview | qr/newpage_%%start_time%%.+ccc_%%start_time%%.+bbb_%%start_time%%.+aaa_%%start_time%%/ |

Revisions sort

| *Comment* | Test case: Watchlist sort by Revisions |  |
| select_and_wait | sort-picker | label=Revisions |
| text_like | st-listview | qr/newpage_%%start_time%%.+aaa_%%start_time%%/ |

| *Comment* | label=Revisions (asc) |  |
| select_and_wait | sort-picker | index=4 |
| text_like | st-listview | qr/aaa_%%start_time%%.+newpage_%%start_time%%/ |

| *Comment* | label=Revisions (desc) |  |
| select_and_wait | sort-picker | index=4 |
| text_like | st-listview | qr/newpage_%%start_time%%.+aaa_%%start_time%%/ |

create a user that lexically precedes the logged in user by creating a user that begins with start_time
However, don't use %%email%% in that username because that permanently creates another user name in the user DB that
contains %%email%% as a substring and that messes up other tests like Test Case: Email

| *Comment* | Test Case: Watchlist verify revision by different user |  |

| set | s_user | %%start_time%%@%%start_time%%.socialtext.net |
| st-admin | create-user --email %%s_user%% --password 123456 |  |
| st-admin | add-member --email %%s_user%% --workspace %%workspace%% |  |
| st-admin | update-page --email %%s_user%% --workspace %%workspace%% --page "bbb_%%start_time%%" < %%wikitest_client_files%%wikitest.txt | The "bbb_%%start_time%%" page has been updated. |

| *Comment* | Test Case: Watchlist navigate away and reload Watchlist |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| click_and_wait | st-wiki-subnav-link-whats-new |  |
| click_and_wait | link=Your Watchlist |  |

| *Comment* | Test case: Watchlist Teardown |  |
| st_admin | purge-page --w %%workspace%% --page aaa_%%start_time%% | purged |
| st_admin | purge-page --w %%workspace%% --page bbb_%%start_time%% | purged |
| st_admin | purge-page --w %%workspace%% --page ccc_%%start_time%% | purged |
| st_admin | purge-page --w %%workspace%% --page newpage_%%start_time%% | purged |

| *Comment* | Test case: Watchlist COMPLETED |

^ Remaining TODO:

| Figure out a way to check which element of a dropdown menu is currently selected, text_like does not do this | Check dropdown menu functionality in Settings-&gt;Watchlist |  |
| Change notification to every minute, then edit a page in the watchlist | notification is saved as Every Minute |  |
| Wait a few minutes, then read email | watchlist notification message received |  |
| In the email, click through to change the preference for notification frequency | arrive at correct UI page |  |
| if preference in watchlist email is set to display name, links, edited by and edited date, the email is displayed correctly according to the preference | verify correct email content |  |
| if preference in watchlist email is set to display page title and link only, the email is displayed correctly | change preference, edit a watched page, receive email, verify correct email content |  |
| clicking on a page link in the watchlist email takes you to the correct page |  |  |
| when a page is removed from the watchlist, it is removed from email | remove a page from the watchlist, edit a watched page, receive email, verify that removed page is not present |  |
| when a page is removed from watch list, it is removed from rss | click RSS icon for watchlist; examine RSS content |  |
