| *Comment* | Test Case: Group Home Widget Permissions |

* Fixture: SocialWidgets

| *Comment* | Test Case: Group Home Widget Permissions Setup |  |  |
| st-setup-a-group | 1 | 0 | 0 |
| set | just_a_member_short | justgroupmbr%%start_time%% |  |
| set | just_a_member | %%just_a_member_short%%@matt.socialtext.net |  |

| set | non_member_short | nongroupmember%%start_time%% |  |
| set | non_member | %%non_member_short%%@matt.socialtext.net |  |
| st-admin | create-user --e %%just_a_member%% --p %%password%% --account %%group_acct%% | was created |  |
| st-admin | add-member --e %%just_a_member%% --g %%group_id%% | is now a member of |  |
| st-admin | create-user --e %%non_member%% --p %%password%% --account %%group_acct%% | was created |  |

| *Comment* | Test Case: Group Home Widget Permissions Login as %%group_user%%, do not see edit group or edit layout buttons |  |
| st-logoutin | %%group_user%% | %%password%% |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_element_not_present_ok | st-edit-group | 30000 |
| wait_for_element_not_present_ok | st-edit-layout | 30000 |

| *Comment* | Test Case: Group Home Widget Permissions Promote to admin, *do* see edit group or edit layout buttons |  |
| st-admin | add-group-admin --g %%group_id%% --e %%group_user%% | is now a admin of the |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_text_present_ok | There are no people tags for people in this group yet. | 30000 |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |

| *Comment* | Test Case: Group Home Widget Permissions Tags in "People Tags" Widget are localized to the group |  |  |
| *Comment* | Test Case: Group Home Widget Permissions Tag %%group_user%% |  |  |
| set | tag_visible_one | groupusershort%%start_time%% |  |
| call | [st-tag-user] | find_user_short=%%group_user_short%% | tag_to_apply=%%tag_visible_one%% |

| *Comment* | Test Case: Group Home Widget Permissions Tag %%just_a_member%% |  |  |
| set | tag_visible_two | membershortmbr%%start_time%% |  |
| call | [st-tag-user] | find_user_short=%%just_a_member_short%% | tag_to_apply=%%tag_visible_two%% |  |

| *Comment* | Test Case: Group Home Widget Permissions Tag %%non_member%% |  |  |
| set | tag_invisible | nonmembernotamembert%%start_time%% |  |
| call | [st-tag-user] | find_user_short=%%non_member_short%% | tag_to_apply=%%tag_invisible%% |  |

| *Comment* | Test Case: Group Home Widget Permissions - On Group Home, See %%tag_visible_one%% and %%tag_visible_two%% but not %%tag_invisible%% |  |
| st-process-jobs |  |  |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_element_visible_ok | link=%%tag_visible_one%% | 30000 |
| wait_for_element_visible_ok | link=%%tag_visible_two%% | 30000 |
| wait_for_element_not_present_ok | link=%%tag_invisible%% | 30000 |
| wait_for_text_not_present_ok | There are no people tags for people in this group yet. | 30000 |

| *Comment* | Test Case: Group Home Widget Permissions Active Content Widget disappears if you remove the workspace associated |  |
| set | test_ws | testwsgroup%%start_time%% |
| st-admin | create-workspace --name %%test_ws%% --title %%test_ws%% | was created |
| st-admin | add-member --g %%group_id%% --w %%test_ws%% | now has the role of 'member' |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_text_present_ok | Active Content | 30000 |
| st-admin | remove-member --g %%group_id%% --w %%test_ws%% | is no longer a member of |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_text_not_present_ok | Active Content | 30000 |
| text_unlike | //body | Active Content |

| *Comment* | Test Case: Group Home Widget Single Account admin has edit group and edit layout buttons |  |
| set | this_account_admin | account_admin%%start_time%%@matt.socialtext.net |
| st-admin | create-user --e %%this_account_admin%% --p %%password%% --account %%group_acct%% | was created |
| st-admin | add-account-admin --e %%this_account_admin%% --account %%group_acct%% | now has the role of 'admin' in the |
| st-logoutin | %%this_account_admin%% | %%password%% |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |

| *Comment* | Test Case: Group Home Widget Permissions - Control Panel ('accounts') Admin has edit group and edit layout buttons |  |
| set | group_cp_admin | group_cp_admin%%start_time%%@matt.socialtext.net |
| st-admin | create-user --e %%group_cp_admin%% --p %%password%% --account %%group_acct%% | was created |
| st-admin | give-accounts-admin --e %%group_cp_admin%% | now has accounts admin access |
| st-logoutin | %%group_cp_admin%% | %%password%% |
| open_ok | /st/group/%%group_id%% |  |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |



| *Comment* | Test Case: Group Home Widget Permissions TEARDOWN |  |
| st-admin | delete-workspace --no-export --w %%test_ws%% | was deleted |
| delete-group | %%group_id%% |  |

| *Comment* | Test Case: Group Home Widget Permissions COMPLETED |  |
