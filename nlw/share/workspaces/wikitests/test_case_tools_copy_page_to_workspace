| *Comment* | Test Case: Tools: Copy Page to Workspace |

| set | newspace | newspace-%%start_time%% |
| set | newtitle | Newspace %%start_time%% |
| set | this_title | Copy This Page %%start_time%% |
| set | this_id | copy_this_page_%%start_time%% |
| set | this_content | Copy This Page %%start_time%% content |
| set | new_content | Copy This Page %%start_time%% NEW content |
| set | this_tag | Copy This Tag %%start_time%% |
| set | copy_title | Page Copied %%start_time%% |
| set | copy_id | page_copied_%%start_time%% |

| *Comment* | Test Case: Tools: Copy Page to Workspace. Create a target workspace |  |
| st-admin | create-workspace --empty --name %%newspace%% --title "%%newtitle%%" | qr/A new workspace named "%%newspace%%" was created/ |
| st-admin | add-member --email %%email%% --workspace %%newspace%% | qr/%%username%%.+now has the role of 'member' in the %%newspace%% workspace/ism |

| *Comment* | Test Case: Tools: Copy Page to Workspace Create test page |  |

| call | [st-edit-new-page] | ws=%%workspace%% | title=%%this_title%% | content=%%this_content%% |
| call | [st-tag-page] | tag_to_apply=%%this_tag%% |  |  |

| st_upload_if_highperms | wikitest.jpg |  |


| *Comment* | Test Case: Tools: Copy Page to Workspace. Copy the page |  |
| click_ok | link=Copy Page to Workspace |  |
| wait_for_element_visible_ok | st-copy-workspace | 5000 |
| wait_for_element_visible_ok | st-copy-newname | 5000 |
| wait_for_element_visible_ok | st-copy-savelink | 5000 |

| select_ok | st-copy-workspace | label=%%newtitle%% |
| type_ok | st-copy-newname | %%copy_title%% |
| click_and_wait | st-copy-savelink |  |

| *Comment* | Test Case: Tools: Copy Page to Workspace. Let it transit to new workspace |  |  |  |
| location_like | /%%newtitle%%/%%copy_title%% |  |  |  |
| wait_for_element_visible_ok | st-display-mode-widgets | 5000 |  |  |
| text_like | st-display-mode-widgets | %%this_tag%% |  |  |
| text_like | st-page-titletext | %%copy_title%% |  |  |
| text_like | content | %%this_content%% |  |  |

| *Comment* | Test Case: Tools: Copy Page to Workspace. Edit the original the page |  |  |  |

| call | [st-edit-this-page] | ws=%%workspace%% | thispage=%%this_title%% | content=%%new_content%% |

| *Comment* | Test Case: Tools: Copy Page to Workspace. Copy the edited page and Cancel |  |
| click_ok | link=Copy Page to Workspace |  |
| wait_for_element_visible_ok | st-copy-workspace | 5000 |
| wait_for_element_visible_ok | st-copy-newname | 5000 |
| wait_for_element_visible_ok | st-copy-savelink | 5000 |

| type_ok | st-copy-newname | Untitled Page |
| click_ok | st-copy-savelink |  |
| wait_for_element_visible_ok | st-copy-error | 5000 |
| text_like | st-copy-error | The page name you selected, "Untitled Page", is not allowed. Please enter or change the page name. |
| click_ok | st-copy-cancellink |  |
| location_like | /%%workspace%%/%%this_title%% |  |

| *Comment* | Test Case: Tools: Copy Page to Workspace. Copy the edited page. navigate away and back |  |
| click_and_wait | link=Workspaces |  |
| open_ok | /%%workspace%%/%%this_title%% |  |
| click_ok | link=Copy Page to Workspace |  |
| wait_for_element_visible_ok | st-copy-workspace | 5000 |
| wait_for_element_visible_ok | st-copy-savelink | 5000 |
| wait_for_element_visible_ok | st-copy-newname | 5000 |

| select_ok | st-copy-workspace | label=%%newtitle%% |
| type_ok | st-copy-newname | %%copy_title%% |
| click_ok | st-copy-savelink |  |
| wait_for_element_visible_ok | st-copy-error | 5000 |
| text_like | st-copy-error | The new page name you selected, "Page Copied %%start_time%%", is already in use |
| *Comment* | Test Case: Tools: Copy Page to Workspace. Force copy  |  |
| click_and_wait | st-copy-savelink |  |

| *Comment* | Test Case: Tools: Copy Page to Workspace. verify copy of edited page |  |
| location_like | /%%newspace%%/%%copy_id%% |  |
| wait_for_element_visible_ok | link=Copy This Tag %%start_time%% |  |
| st_check_files_if_highperms | wikitest.jpg |  |

| open_ok | /%%newspace%%/index.cgi?action=revision_list;page_name=%%copy_id%% |  |
| click_and_wait | link=Compare Revisions |  |
| text_like | content | %%this_content%% |
| text_like | content | %%new_content%% |

| *Comment* | Test Case: Tools: Copy Page to Workspace. verify tag copied |  |
| click_and_wait | link=Back To Current Revision |  |
| wait_for_element_visible_ok | link=%%this_tag%% | 10000 |

| *Comment* | Test Case: Tools: Copy Page to Workspace TEARDOWN |  |

| st-process-jobs |  |  |
| st-admin | purge-page --w %%workspace%% --page %%this_id%% | was purged |
| st-admin | delete-workspace --workspace %%newspace%% --no-export | has been deleted |

| *Comment* | Test Case: Tools: Copy Page to Workspace COMPLETED |  |
