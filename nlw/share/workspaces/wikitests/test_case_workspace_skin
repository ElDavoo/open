* HighPermissions

| *Comment* | Test Case: Workspace Skin |  |
| *Comment* | Need skin.tgz and badskin.tgz to be in %%wikitest_files%% |  |


| *Comment* | Test Case: Workspace Skin make a scratch workspace |  |
| set | sws | sws-%%start_time%% |
| st-admin | create-workspace --name %%sws%% --title %%sws%% | created |
| st-admin | add-member --w %%sws%% --u %%username%% | now has the role |
| open_ok | /%%sws%%/ |  |

| *Comment* | Test Case: Workspace Skin - disable skin upload |  |
| st-admin | set-workspace-config --workspace %%sws%% allows_skin_upload 0 | has been updated |
| click_and_wait | link=Settings |  |
| text_unlike | //body | Workspace Skin |

| *Comment* | Test Case: Workspace Skin - enable skin upload, no link for non-admin |  |
| st-admin | set-workspace-config --workspace %%sws%% allows_skin_upload 1 | has been updated |
| click_and_wait | link=Settings |  |
| text_unlike | //body | Workspace Skin |

| *Comment* | Test Case: Workspace Skin - enable skin upload, promote to admin |  |
| st-admin | add-workspace-admin --w %%sws%% --u %%username%% | now has the role |

| *Comment* | Test Case: Workspace Skin Need skin.tgz and badskin.tgz in %%wikitest_files%% |  |
| click_and_wait | link=Settings |  |
| text_like | Workspace Skin |  |
| click_and_wait | link=Workspace Skin |  |
| text_like | Default Skin |  |
| text_like | Customized Skin |  |

| setTimeout | 120000 |  |

| *Comment* | Test Case: Workspace Skin upload button |  |
| click_and_wait | st-workspaceskin-submit |  |
| text_like | contentRight | A custom skin file was not uploaded. |
| is_checked_ok | st-workspaceskin-default |  |

| *Comment* | Test Case: Workspace Skin navigate away and back to clear error box |  |
| click_and_wait | link=Workspace Privacy |  |
| click_and_wait | link=Workspace Skin |  |

| *Comment* | Test Case: Workspace Skin upload badskin.tgz |  |
| wait_for_element_visible_ok | st-workspaceskin-file | 30000 |
| type_ok | st-workspaceskin-file | %%wikitest_files%%badskin.tgz |
| click_and_wait | st-workspaceskin-submit |  |
| text_like | contentRight | Could not extract files from the skin archive |

| *Comment* | Test Case: Workspace Skin navigate away and back to clear error box |  |
| click_and_wait | link=Workspace Privacy |  |
| click_and_wait | link=Workspace Skin |  |

| *Comment* | Test Case: Workspace Skin upload good skin.tgz |  |
| wait_for_element_visible_ok | st-workspaceskin-file | 30000 |
| type_ok | st-workspaceskin-file | %%wikitest_files%%skin.tgz |
| click_and_wait | st-workspaceskin-submit |  |
| text_like | contentRight | button-green/left-top.gif |

| *Comment* | Test Case: Workspace Skin cancel button |  |
| check_ok | st-workspaceskin-custom |  |
| click_ok | link=Cancel |  |
| is_checked_ok | st-workspaceskin-default |  |

| *Comment* | Test Case: Workspace Skin swap to custom skin |  |
| check_ok | st-workspaceskin-custom |  |
| is_checked_ok | st-workspaceskin-custom |  |
| click_and_wait | link=Save |  |

| *Comment* | use text_like to check for uploaded-skin link because wait_for_element has a bug when trying to wait for links or anchors |  |
| text_like | //link[contains(@href,'uploaded-skin')] | qr/^$/ |
| is_checked_ok | st-workspaceskin-custom |  |

| *Comment* | Test Case: Workspace Skin swap to default skin |  |
| check_ok | st-workspaceskin-default |  |
| is_checked_ok | st-workspaceskin-default |  |
| click_and_wait | st-standard-submitbutton | Save Button in uploaded skin |

| wait_for_element_visible_ok | link=Save | 30000 |
| wait_for_element_visible_ok | link=Community | 30000 |
| is_checked_ok | st-workspaceskin-default |  |

| *Comment* | Test Case: Workspace Skin swap back to custom skin |  |
| check_ok | st-workspaceskin-custom |  |
| click_and_wait | link=Save | Save |
| text_like | //link[contains(@href,'uploaded-skin')] | qr/^$/ |

| *Comment* | Test Case: Workspace Skin remove existing files |  |
| click_and_wait | st-workspaceskin-removesubmit |  |
| wait_for_text_not_present_ok | button-green/left-top.gif | 30000 |
| wait_for_element_visible_ok | link=Save | 30000 |
| wait_for_element_visible_ok | link=Community | 30000 |
| is_checked_ok | st-workspaceskin-default |  |

| *Comment* | Test Case: Workspace Skin navigate away and back to clear error box |  |
| click_and_wait | link=Workspace Privacy |  |
| click_and_wait | link=Workspace Skin |  |

| *Comment* | Test Case: Workspace Skin upload non-archive |  |
| wait_for_element_visible_ok | st-workspaceskin-file | 30000 |
| type_ok | st-workspaceskin-file | %%wikitest_files%%wikitest.txt |
| click_and_wait | st-workspaceskin-submit |  |
| text_like | contentRight | Could not extract files from the skin archive |

| *Comment* | Test Case: Workspace Skin navigate away and back to clear error box |  |
| click_and_wait | link=Workspace Privacy |  |
| click_and_wait | link=Workspace Skin |  |

| wait_for_element_visible_ok | st-workspaceskin-file | 30000 |
| type_ok | st-workspaceskin-file | %%wikitest_files%%wikitest.tgz |
| click_and_wait | st-workspaceskin-submit |  |
| text_like | contentRight | Could not extract files from the skin archive |

| *Comment* | Test Case: Workspace Skin navigate away and back to clear error box |  |
| click_and_wait | link=Workspace Privacy |  |
| click_and_wait | link=Workspace Skin |  |

| wait_for_element_visible_ok | st-workspaceskin-file | 30000 |
| type_ok | st-workspaceskin-file | xxxx |
| click_and_wait | st-workspaceskin-submit |  |
| text_like | contentRight | A custom skin file was not uploaded |

| *Comment* | Test Case: Workspace Skin TEARDOWN |  |
| st-admin | delete-workspace --w %%sws%% --no-export | deleted |

| *Comment* | Test Case: Workspace Skin COMPLETED |  |
