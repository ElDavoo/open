| *Comment* | Test Case: Page Tracker Widget |  |

* Fixture: SocialWidgets

| *Comment* | Test Case: Page Tracker Widget setup a page to tag and track |  |
| set | ptw_page_1 | tracked_page_%%start_time%% |
| set | ptw_page_2 | widget_page_%%start_time%% |
| set | ptw_tag_1 | tracked_tag_%%start_time%% |
| set | ptw_tag_1_prefix | tracked |
| set | ptw_tag_1_suffix | tag_%%start_time%% |
| set | ptw_tag_2 | filtered_tag_%%start_time%% |
| set | ptw_title | widget_title_%%start_time%% |

| st-create-wikipage | %%workspace%% | %%ptw_page_1%% |
| st-add-page-tag | /%%workspace%%/index.cgi?%%ptw_page_1%% | %%ptw_tag_1%% |
| st-add-page-tag | /%%workspace%%/index.cgi?%%ptw_page_1%% | %%ptw_tag_2%% |

| st-single-widget-in-dashboard | gallery-widget-Page Tracker |  |

| selectFrame | //div[@class='widgetContent']//iframe[@class='widgetWindow'] |  |
| text_like | //form[@id='formPrefs'] | Widget Title: |
| text_like | //form[@id='formPrefs'] | Basics |

| *Comment* | Test Case: Page Tracker Widget basics section |  |
| wait_for_element_visible_ok | //input[@name='Workspace'] | 30000 |
| type_lookahead_ok | //input[@name='Workspace'] | %%workspace%% |
| wait_for_element_visible_ok | //div[@class='lookaheadItem']/a[contains(text(),'Canonical')] | 30000 |
| click_ok | //div[@class='lookaheadItem']/a[contains(text(),'Canonical')] |  |
| wait_for_element_visible_ok | //input[@name='Title'] | 30000 |
| type_ok | //input[@name='Title'] | %%ptw_title%% |

| *Comment* | Test Case: Page Tracker Widget columns section *Heading and Notes need ids* |  |
| wait_for_element_visible_ok | //input[@class='tag ui-input-text ui-body-null ui-corner-all ui-shadow-inset ui-body-c ui-focus'] | 30000 |
| type_lookahead_ok | //input[@class='tag ui-input-text ui-body-null ui-corner-all ui-shadow-inset ui-body-c ui-focus'] | %%ptw_tag_1_prefix%% |
| wait_for_element_visible_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%ptw_tag_1_suffix%%')] | 30000 |
| click_ok | //div[@class='lookaheadItem']/a[contains(text(),'%%ptw_tag_1_suffix%%')] |  |

| *Comment* | Test Case: Page Tracker Widget page filtering section *Both inputs need ids* |  |

| *Comment* | Test Case: Page Tracker Widget item background section *input needs id* |  |

| *Comment* | Test Case: Page Tracker Widget item notes section *all inputs need ids* |  |

| *Comment* | Test Case: Page Tracker Widget preview and save widget *preview button needs id* |  |
| *Comment* | click Preview manually |
| wait_for_element_visible_ok | st-widget-opensocial-setup-save | 30000 |
| wait_for_element_visible_ok | st-widget-opensocial-setup-cancel | 30000 |
| wait_for_text_present_ok | %%ptw_title%% | 30000 |
| wait_for_text_present_ok | %%ptw_tag_1%% | 30000 |
| wait_for_text_present_ok | %%ptw_page_1%% | 30000 |
| click_ok | st-widget-opensocial-setup-save |  |
| wait_for_element_not_present_ok | st-widget-opensocial-setup-save | 30000 |

| *Comment* | Test Case: Page Tracker Widget check inserted code, save page |  |
| pause | 2000 |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| verifyValue | wikiwyg_wikitext_textarea | `{widget: page_tracker __title__=Page%20Tracker __width__=600 up_Title=%%ptw_title%% up_Workspace=%%workspace%% up_IncludeTags=%%ptw_tag_2%% up_ExcludeTags= up_QuerySuffix= up_StateTags=%%ptw_tag_1%%= up_BackgroundTags=%%ptw_tag_2%%=#ABCDEF up_StampTags=%%ptw_tag_2%%=Filter= up_PagePrefix= up_HoverBackground=#FFFFCC up_RefreshInterval=1800 up_Editable=1}` |
| st-page-save |  |  |

| *Comment* | Test Case: Page Tracker Widget check page |  |
| wait_for_element_visible_ok | //div[@class='regular widget'] | 30000 |
| wait_for_text_present_ok | %%ptw_title%% | 30000 |
| wait_for_text_present_ok | %%ptw_tag_1%% | 30000 |
| wait_for_text_present_ok | %%ptw_page_1%% | 30000 |

| *Comment* | Test Case: Page Tracker Widget TEARDOWN |  |
| st-process-jobs |  |  |
| st-admin | purge-page --workspace %%workspace%% --page %%ptw_page_1%% |  |
| st-admin | purge-page --workspace %%workspace%% --page %%ptw_page_2%% |  |


^ END

and everything (including plus/minus) have IDs now

[8:14pm] au: so the last row has ID
[8:14pm] au: StateTags-PageTag-new
[8:14pm] ken: will see if the elements are visible after the selectFrame without having to qualify everything with //form but that's not awful ...
[8:15pm] au: while the fields in the rows before the last one in a fieldset will be
[8:15pm] au: StateTags-PageTag-0
[8:15pm] au: StateTags-PageTag-1
[8:15pm] au: etc
[8:15pm] au: to click the add/plus button, use
[8:15pm] au: StateTags-row-0
[8:15pm] au: StateTags-row-1
[8:15pm] au: (for minus) and
[8:15pm] au: StateTags-row-new
[8:15pm] au: (for plus)
[8:20pm] au: @name='Workspace' can simply use ID = Workspace now
