*user action* | *correct response* | *comment*
Add tag "foo", return | appears in sidebar 
Add two word tag "foo bar" to another page, return | appears in sidebar 
Add tag "Foster City", return | appears in sidebar with correct capitalization 
Look ahead: start to type "fo" | sidebar autosuggests "foo", "foo bar", "foster city"

| *Comment* | Starting Test Case: Tagging |  |

| setSpeed | 100 |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| clickAndWait | st-newpage-link |  |

| wait_for_element_visible_ok | link=Advanced | 10000 |
| click_ok | link=Advanced |  |
| type_ok | st-newpage-pagename-edit | tag_page%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | tag_page%%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-tags-addlink |  |
| type_ok | st-tags-field | fog%%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |

wait_for_text_present_ok | Adding tag | 30000 |
wait_for_text_not_present_ok | Adding tag | 30000 |

| wait_for_text_present_ok | fog%%start_time%% | 30000 |

*Comment*: To prevent interrmittent failures "pause" is still necessary even after wait_for_text_present_ok

| pause | 10000 |  |

| text_like | link=fog%%start_time%% | fog%%start_time%% |

| type_ok | st-tags-field | foo bar%%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | foo bar%%start_time%% | 30000 |

| pause | 4000 |  |

| text_like | link=foo bar%%start_time%% | foo bar%%start_time%% |

| *Comment* | Test Case: Tagging - special chars (limited until we ca get bz 371 resolved) |

| type_ok | st-tags-field | special chars @#$ %%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | special chars @#$ %%start_time%% | 30000 |

| pause | 4000 |

| text_like | link=special chars @#$ %%start_time%% | special chars @#$ %%start_time%% |

| type_ok | st-tags-field | 所以 |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | 所以 | 30000 |

| pause | 4000 |

TODO - Get this to work - | text_like | link=所以 | 所以 |

| type_ok | st-tags-field | special chars ,[] %%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | special chars ,[] %%start_time%% | 30000 |

| pause | 4000 |

| text_like | link=special chars ,[] %%start_time%% | special chars ,[] %%start_time%% |

| type_ok | st-tags-field | Foster City%%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | Foster City%%start_time%% | 30000 |

| pause | 4000 |  |

| text_like | link=Foster City%%start_time%% | Foster City%%start_time%% |

| type_ok | st-tags-field | fo |
| wait_for_text_present_ok | Suggestions | 30000 |
| text_like | st-tags | foo bar%%start_time%% |
| text_like | st-tags | Foster City%%start_time%% |

Remove tag: click on little box next to "foo" | tag disappears, system displays: These tags have been removed: foo 
Click on tag "foo bar" | system navigates to the list of pages with the tag "foo bar"

| *Comment* | Test Case: Tagging deleting tags |  |
| wait_for_element_present_ok | link=[x] | 20000 |
| pause | 5000 |  |
| click_ok | link=[x] |  |
| wait_for_text_present_ok | These tags have been removed | 30000 |

*Comment*: Unfortunately, tags can show up in any order. Maybe we need ids for the [x] delete button?

| text_like | st-tags-deletemessage | qr/These tags have been removed:/ |
| clickAndWait | link=foo bar%%start_time%% |  |
| *Comment* | Test Case: Tagging tag list view: tag foo bar%%start_time%% |  |
| text_like | link=foo bar%%start_time%% as a weblog | foo bar%%start_time%% as a weblog |

Add any other tag to three different pages | tag is added

| *Comment* | Test Case: Tagging add tag to three new pages |  |
| *Comment* | Tag Page 1 |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| clickAndWait | st-newpage-link |  |
| type_ok | st-newpage-pagename-edit | tag_page1%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | tag_page1%%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-tags-addlink |  |
| type_ok | st-tags-field | tagtest%%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | tagtest%%start_time%% | 30000 |

| *Comment* | Tag Page 2 |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| clickAndWait | st-newpage-link |  |
| type_ok | st-newpage-pagename-edit | tag_page2%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | tag_page2%%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-tags-addlink |  |
| type_ok | st-tags-field | tagtest%%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | tagtest%%start_time%% | 30000 |

| *Comment* | Tag Page 3 |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| clickAndWait | st-newpage-link |  |
| type_ok | st-newpage-pagename-edit | tag_page3%%start_time%% |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 10000 |
| type_ok | wikiwyg_wikitext_textarea | tag_page3%%start_time%% |
| clickAndWait | st-save-button-link |  |
| click_ok | st-tags-addlink |  |
| type_ok | st-tags-field | tagtest%%start_time%% |
| wait_for_element_present_ok | st-tags-addbutton | 20000 |
| click_ok | st-tags-addbutton |  |
| wait_for_text_present_ok | tagtest%%start_time%% | 30000 |

| *Comment* | Test Case: Tagging checking revisions |  |

Click Revisions | new revision created for new tag 
Compare top two revisions | only difference is in added tag

| clickAndWait | st-page-stats-revisions |  |
| *Comment* | Compare Revisions |  |
| clickAndWait | Button |  |
| text_like | qr/Tags:.+Tags: tagtest%%start_time%%/ |  |

Click on that tag in third page | list appears with correct three pages 
Click on any link in list | that page appears

| clickAndWait | st-back-to-current-revision-link |  |
| clickAndWait | link=tagtest%%start_time%% |  |
| clickAndWait | link=tag_page3%%start_time%% |  |
| text_like | st-page-titletext | tag_page3%%start_time%% |

Remove that tag | tag is removed 
Click Revisions | observe new revision is created 
Compare top two revisions | only difference is in deleted tag

| wait_for_element_present_ok | link=[x] | 20000 |
| pause | 5000 |  |
| click_ok | link=[x] |  |
| wait_for_text_present_ok | These tags have been removed | 30000 |
| text_like | These tags have been removed |  |
| text_like | st-tags-deletemessage | These tags have been removed: tagtest |

JUNE 6 2007 RT 25664. WRONG NUMBER OF REVISIONS

TODO: finish the last part of the test after fixing RT 25664

Navigate to All Tags in list view | All Tags appears 
Observe that tag | tag is still in list 
Click that tag | Tag list page appears with two remaining tagged pages

| *Comment* | Test Case: Tagging Teardown |  |
| open_ok | /%%workspace%%/index.cgi?action=homepage |  |
| st-admin | purge-page --workspace %%workspace%% --page tag_page%%start_time%% | page was purged |
| st-admin | purge-page --workspace %%workspace%% --page tag_page1%%start_time%% | page was purged |
| st-admin | purge-page --workspace %%workspace%% --page tag_page2%%start_time%% | page was purged |
| st-admin | purge-page --workspace %%workspace%% --page tag_page3%%start_time%% | page was purged |

| *Comment* | Test Case : Tagging COMPLETED |  |
