| *Comment* | Test case: Business Control Panel USER |  |
| set | new_acct | acct usertest %%start_time%% |
| set | new_workspace | user-test%%start_time%% |
| set | cli_user | cli_user_test%%start_time%%@ken.socialtext.net |

| st-admin | create-account --name '%%new_acct%%' |
| st-admin | create-workspace --name %%new_workspace%% --title %%new_workspace%% --account '%%new_acct%%' |

| *Comment* | Test case: Business Control Panel create a user, add as admin, verify admin |  |
| open_ok | /nlw/control/user |  |
| st-admin | create-user --email %%cli_user%% --password wikicli --first-name Wiki --last-name CLI --account '%%new_acct%%' | A new user with the username "%%cli_user%%" was created |
| st-admin | add-workspace-admin --email %%cli_user%% --workspace %%new_workspace%% |  |
| click_and_wait | link=Workspaces |  |
| wait_for_element_visible_ok | name | 30000 |
| type_ok | name | %%new_workspace%% |
| st-submit |  |  |
| click_and_wait | link=%%new_workspace%% |  |
| text_like | workspace admin |  |

| *Comment* | Test case: Business Control Panel User exercise 'add user' button |  |
| click_and_wait | link=Accounts |  |
| wait_for_element_visible_ok | st-search-by-name | 30000 |
| wait_for_element_visible_ok | st-submit-search-by-name | 30000 |
| type_ok | st-search-by-name | %%new_acct%% |
| click_and_wait | st-submit-search-by-name |  |
| wait_for_element_visible_ok | link=%%new_acct%% | 30000 |
| click_and_wait | link=%%new_acct%% |  |
| click_and_wait | link=Add User |  |
| type_ok | email_address | bogus |
| click_ok | //input[contains(@id,'add_user')] |  |
| wait_for_text_present_ok | bogus is not a valid email address | 30000 |
| type_ok | email_address | foo%%start_time%%@bar.com |
| type_ok | first_name | firstname |
| type_ok | last_name | lastname |
| type_ok | position | position |
| type_ok | company | company |
| type_ok | location | location |
| type_ok | work_phone | work phone |
| type_ok | mobile_phone | mobile phone |
| type_ok | home_phone | home phone |
| click_ok | //input[contains(@id,'add_user')] |  |
| wait_for_text_present_ok | Added user foo%%start_time%%@bar.com | 30000 |
| click_and_wait | link=Back |  |
| wait_for_element_visible_ok | link=firstname lastname <foo%%start_time%%@bar.com> |  |

| *Comment* | Test case: Business Control Panel User reassign accounts for users and workspaces |  |
| click_and_wait | link=Accounts |  |
| wait_for_element_visible_ok | st-search-by-name | 30000 |
| wait_for_element_visible_ok | st-submit-search-by-name | 30000 |
| type_ok | st-search-by-name | %%new_acct%% |
| click_and_wait | st-submit-search-by-name |  |
| wait_for_element_visible_ok | link=%%new_acct%% | 30000 |
| click_and_wait | link=%%new_acct%% |  |
| click_and_wait | link=Wiki CLI <%%cli_user%%> |  |
| wait_for_element_visible_ok | link=%%new_acct%% |  |
| text_like | Primary Account: %%new_acct%% |  |
| text_like | Socialtext Accounts Access? no |  |
| text_like | Socialtext System Management Access? no |  |
| click_and_Wait | //input[@value='Give Access to Socialtext Accounts'] |  |
| text_like | Gave Socialtext Accounts access to %%cli_user%% |  |
| text_like | Socialtext Accounts Access? yes |  |
| click_and_wait | //input[@value='Remove Access to Socialtext Accounts'] |  |
| text_like | Removed Socialtext Accounts access from %%cli_user%% |  |
| text_like | Socialtext Accounts Access? no |  |
| click_and_wait | //input[@value='Give Access to Socialtext System Management'] |  |
| text_like | Gave Socialtext System Management access to %%cli_user%% |  |
| text_like | Socialtext System Management Access? yes |  |
| click_and_wait | //input[@value='Remove Access to Socialtext System Management'] |  |
| text_like | Removed Socialtext System Management access from %%cli_user%% |  |
| text_like | Socialtext System Management Access? no |  |
| wait_for_element_visible_ok | account_id | 30000 |
| select_ok | account_id | Socialtext |
| click_and_wait | //input[@value='Submit'] |  |
| text_like | Primary Account: Socialtext |  |
| wait_for_element_visible_ok | account_id | 30000 |
| select_ok | account_id | %%new_acct%% |
| wait_for_element_visible_ok | st-assign-to-account-submit | 30000 |
| click_and_wait | st-assign-to-account-submit |  |
| text_like | Primary Account: %%new_acct%% |  |

| *Comment* | Test case: Business Control Panel User Search |  |
| click_and_wait | link=Users |  |
| wait_for_element_visible_ok | username | 30000 |
| type_ok | username | %%cli_user%% |
| st-submit |  |  |
| text_like | Showing 1 - 1 of 1 total. |  |

| *Comment* | Test case: Business Control Panel User CLEANUP |  |
| st-admin | delete-workspace --workspace %%new_workspace%% --no-export |  |
