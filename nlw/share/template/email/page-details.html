[%# @COPYRIGHT@ -%]
[%- USE date -%]
[%- calc = date.calc -%]
[%- email_date = calc.Time_to_Date() -%]
[%- MACRO ago_text(epoch_seconds) BLOCK -%]
  [%- SET escaped_timestamp = page.time_for_user | html %]
  [%- edit_date = calc.Time_to_Date(epoch_seconds) -%]
  [%- delta = calc.Delta_Days(edit_date.0, edit_date.1, edit_date.2, email_date.0, email_date.1, email_date.2) -%]
  [%- IF delta == 0 -%][% loc('today at [_1]', escaped_timestamp) -%]
  [%- ELSIF delta == 1 -%][% loc('yesterday at [_1]', escaped_timestamp) %]
  [%- ELSE -%][% loc('[_1] days ago', delta) %]
  [%- END -%]
[%- END -%]

<li><a href="[% workspace.uri %]?[% page.uri %]">[% page.metadata.Subject %]</a>  [%- IF include_editor %]
    <br />
    [%- IF user.username == page.last_edited_by.username %]
      [% SET escaped_name = loc('you') | html %]
    [% ELSE %]
      [% SET escaped_name = page.last_edited_by.best_full_name( workspace => workspace ) | html %]
    [%- END %]
    [%- SET escaped_editsummary = page.edit_summary | html %]
    [%- SET profile_uri = base_profile_uri _ page.last_edited_by.user_id %]
    [%- IF page.metadata.Revision == 1 %]
      [%- SET action = loc('created by') %]
    [% ELSE %]
      [%- SET action = loc('last edited by') %]
    [%- END %]
    [%- edit_time = ago_text(page.modified_time) -%]
    [%- IF page.edit_summary %]
      [% loc('[_1] <a href="[_4]">[_2]</a> [_5] saying, "[_3]"', action, escaped_name, escaped_editsummary, profile_uri, edit_time) %]
    [% ELSE %]
      [% loc('[_1] <a href="[_3]">[_2]</a> [_4]', action, escaped_name, profile_uri, edit_time) %]
    [%- END %]
  [%- END %]
</li>
