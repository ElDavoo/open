<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="My Conversations">
  <Require feature="dynamic-height" />
  <Require feature="socialtext" />
  </ModulePrefs>
  <Content type="html">
    <![CDATA[

        <style type="text/css">
            .ws-views__MODULE_ID__ { color: #0e93d8; text-align: right; }
            .ws-contrib__MODULE_ID__ { color: #093; text-align: right; }
            #table__MODULE_ID__ td { line-height: 100%; }
        </style>

        <div class='calendarList'>
            <table id="table__MODULE_ID__">
            </table>
        </div>
<script>

var people_base__MODULE_ID__ = "http://demo.socialtext.net:6200/people/";
var icon_base__MODULE_ID__ = "/nlw/plugin/gadgets/images/asset-icons/";
var action_to_icon__MODULE_ID__ = new Array();
action_to_icon__MODULE_ID__["comment"] = "page-comments-24.png";
action_to_icon__MODULE_ID__["tag"] = "tag-24.png";
action_to_icon__MODULE_ID__["edit"] = "page-editing-24.png";
action_to_icon__MODULE_ID__["upload_file"] = "page-editing-24.png";

jQuery.getJSON( '/webplugin/cgi/reports/report.cgi/user_conversations/now/-1month.json', { }, function ( data ) {
  if (data.length == 0) {
      jQuery('<tr>').append(jQuery('<td>').append("No data"));
      gadgets.window.adjustHeight();
      return;
  }
  for (var i=0; i<data.length; i++) {
    var timestamp = data[i][0];
    var user_id = data[i][1];
    var ws_id = data[i][2];
    var ws_title = data[i][3];
    var page_id = data[i][4];
    var page_title = data[i][5];
    var action = data[i][6];
    var icon = action_to_icon__MODULE_ID__[action];
    jQuery('#table__MODULE_ID__').append(
      jQuery('<tr>').append(
        jQuery('<td>').attr("colspan","2").append(
          jQuery('<img style="float:right" height="24" width="24">')
            .attr("src",icon_base__MODULE_ID__ + icon)
        )
        .append(
          jQuery('<img style="float:left" height="48" width="48">')
            //.attr("src",people_base__MODULE_ID__ + user_id + "/small_photo")
            .attr("src",icon_base__MODULE_ID__ + "person-48.png")
        )
        .append(
          user_id + " did action '" + action + "' on page '" + 
          page_title + "' in the '" + ws_title +
          "' workspace at roughly " + timestamp
        )
      )
    )
  }
  jQuery('#__MODULE_ID__ .border:last').remove();
  jQuery('#__MODULE_ID__-table tr:odd').addClass('oddRow');
  gadgets.window.adjustHeight();
});
</script>
    ]]>
  </Content>
</Module>
