<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="All People">
  <Require feature="dynamic-height" />
  <Require feature="socialtext" />
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
        <div id="__MODULE_ID__-content"> </div>
        <script>
    var guanxi_base = 'http://demo.socialtext.net:6200';
    var guanxi = 'http://demo.socialtext.net:6200/people/json';
    gadgets.io.makeRequest(guanxi,putdata);

    function avatar(info) {
    return    "<img style='width: 27x; height: 27px' src='" + info.image + "'>&nbsp&nbsp"
            + "<a target='parent' href='" + guanxi_base + "/people/" +info.fullname+"'>"
            + info.fullname + "</a>";
    }

    function putdata(result) {
        var people = gadgets.json.parse(result.data);
        var ix =0;
        for (var i=0; i<people.length; i++) {
            var person = people[i];
            if (ix++ < 100) {
                var info = person; 

                if (info.first_name) {
                    info.fullname = info.first_name;
                    if (info.last_name)
                        info.fullname += ' ' + info.last_name;
                }
                else {
                    info.fullname = info.name;
                }
                    
                photo = "http://demo.socialtext.net:6200/people/" + info.name + "/small_photo";
                jQuery('#__MODULE_ID__-content').append(
                jQuery('<div class="myContent">').append(
                        avatar({
                            fullname: info.fullname,
                            username: info.name,
                            image: photo
                        })),
                    jQuery('<div class="border">')
                );
              }
          }
       gadgets.window.adjustHeight();
    }

</script>

    ]]>
  </Content>
</Module>
