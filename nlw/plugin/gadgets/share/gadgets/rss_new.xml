<Module>
  <ModulePrefs title="__UP_title__">
    <Require feature="dynamic-height" />
    <Require feature="setprefs" />
    <Require feature="settitle" />
    <Require feature="dynamic-height" />
    <Require feature="socialtext" />
  </ModulePrefs>
 <UserPref name="rss_feed" display_name="RSS Feed" default_value="http://www.socialtext.com/blog/feed"/>
 <UserPref name="title" default_value="RSS Viewer" datatype="hidden"/>
  <Content type="html">
    <![CDATA[

<style>

  #my__MODULE_ID__-content {
    text-align: left;
    margin-left: 5px;
  }
  .rss_item {
    padding: 5px;  
  }

  .rss_title {
  }
  a {
    text-decoration: none;  
    font-size: 1.2em;
  }
  .rss_body {
    font-size: 1.2em;
  }

</style>
<div id="my__MODULE_ID__-content"></div>
<script>
    var params = {};
    var url = '__UP_rss_feed__';
    var prefs = new gadgets.Prefs();

    if ('__UP_title__')
        gadgets.window.setTitle('__UP_title__');

    function get_title (node) {
        var title = 'Untitled';
        var tit_els = node.getElementsByTagName('title');
        if (tit_els && tit_els.length) {
            title = tit_els[0].textContent;
        }
        return title;
    }

    function get_items (node) {
        var items = [];
        var nodes = node.getElementsByTagName('item');
        for (var i=0; i<nodes.length; i++) {
            var title = nodes[i].getElementsByTagName('title')[0];
            var link  = nodes[i].getElementsByTagName('link')[0];
            var desc  = nodes[i].getElementsByTagName('description')[0];
            items.push({
                title : title ? title.textContent : '',
                link  : link  ? link.textContent  : '',
                desc  : desc  ? desc.childNodes[0].nodeValue.substr(0,250) : '',
            });
        }
        return items;
    }

    var callback = function(xml) {
        var title = get_title(xml.data);
        console.log(title);
        if (title) {
            gadgets.window.setTitle(title);
            prefs.set('title',title);
        }

        var items = get_items(xml.data);

        var content_node = document.getElementById('my__MODULE_ID__-content');

        for (var i=0; i<items.length; i++) {
            var item = items[i];

            var item_div = document.createElement('div');
            var h4 = document.createElement('h4');
            var a = document.createElement('a');
            var border = document.createElement('div');
            var desc_div = document.createElement('p');

            item_div.className = 'myContent';
            border.className = 'border';
            a.href = item.link
            a.style['text-size'] = '10px';
            a.style['text-decoration'] = 'none';

            desc_div.innerHTML = item.desc;

            item_div.appendChild(h4);
            h4.appendChild(a);
            a.appendChild(document.createTextNode(item.title));
            item_div.appendChild(desc_div);

            content_node.appendChild(item_div);
            content_node.appendChild(border);
        }
        gadgets.window.adjustHeight();
    }
    gadgets.util.registerOnLoadHandler( function() {
        params.CONTENT_TYPE = "DOM";
        gadgets.io.makeRequest(url, callback, params);
    });
</script>

    ]]>

  </Content>
</Module>
