<Module>
  <ModulePrefs title="RSS Feed">
    <Require feature="dynamic-height" />
    <Require feature="setprefs" />
    <Require feature="settitle" />
    <Require feature="socialtext" />
    <UserPref name="rss_feed" display_name="RSS URL" default_value="http://www.news1130.com/rss/local.jsp"/>
    <Require feature="dynamic-height" />
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
        <div style="font-size:10pt" id="__MODULE_ID__-content">
</div>
    <style>
      .myContent {
        font-size: 10px;
      }
      .myContent h4 a {
        font-size: 10px;
      }
    </style>
<script>
 function updateRSS(url) {

   var rurl = '/data/gadget/proxy?url='+url;
   var show_desc = false;

   jQuery.ajax({
          type: "GET",
          url: rurl,
          dataType: "xml",
          error: function (XMLHttpRequest, textStatus, errorThrown) {
           jQuery('#__MODULE_ID__-content').html('<b>Failed to retrieve RSS data</b>');
          },

          success: function(xml) {
             jQuery('#__MODULE_ID__-content').empty(); 
             var title = jQuery(xml).find('channel').find('title:first');
             var count = 0;
             jQuery('item',xml).each(function() { 
                 if (count < 5) {
                   var title = jQuery(this).find('title').text();
                   var link  = jQuery(this).find('link').text();
                   var desc  = "";
                   var full_description = desc = jQuery(this).find('description').text();

                   if (show_desc) {
                       desc = full_description;
                   } else {
                       desc = full_description.substr(0,250);
                       desc = desc + ".."; 
                   }

                   jQuery('#__MODULE_ID__-content').append(
                       jQuery('<div class="myContent">').append(
                           jQuery('<h4>').append(
                               jQuery('<a style="text-size: 10px; text-decoration: none">')
                                   .attr('href',link)
                                   .append(title || 'huh')
                           ),
                           jQuery('<p>').append(desc)
                       ),
                       jQuery('<div class="border">')
                   );
                 }
                 count++;
             });   
           gadgets.window.adjustHeight(); 

          }
        
        }); 
  } 

  gadgets.util.registerOnLoadHandler( function () {
    updateRSS('__UP_rss_feed__');
  });

</script>

    ]]>
  </Content>
</Module>
